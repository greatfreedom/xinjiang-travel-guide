<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ”¾é£è‡ªæˆ‘Â·æ¢¦æƒ³æ°¸é©» - æ–°ç–†è‡ªé©¾ä¹‹æ—…</title>
    <script src="https://webapi.amap.com/maps?v=1.4.15&key=b9a6635dec0a3c95dacc2a840cb2e1d1"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card h2 {
            color: #4a5568;
            margin-bottom: 20px;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }
        
        .trip-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .overview-item {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        
        .overview-item h3 {
            margin-bottom: 10px;
        }
        
        .map-container {
            height: 500px;
            width: 100%;
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
            position: relative;
            background: #f5f5f5;
            border: 1px solid #e0e0e0;
        }
        
        .itinerary {
            display: grid;
            gap: 15px;
        }
        
        .day-card {
            background: #f7fafc;
            border-left: 5px solid #667eea;
            padding: 20px;
            border-radius: 0 10px 10px 0;
            transition: all 0.3s ease;
        }
        
        .day-card:hover {
            background: #edf2f7;
            border-left-color: #764ba2;
        }
        
        .day-number {
            color: #667eea;
            font-weight: bold;
            font-size: 1.1em;
        }
        
        .destination {
            font-size: 1.2em;
            font-weight: bold;
            margin: 10px 0;
            color: #2d3748;
        }
        
        .activities {
            color: #4a5568;
            font-style: italic;
        }
        
        .cost-breakdown {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .cost-item {
            background: #f0f8ff;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }
        
        .cost-item h4 {
            color: #667eea;
            margin-bottom: 10px;
        }
        
        .cost-amount {
            font-size: 1.3em;
            font-weight: bold;
            color: #2d3748;
        }
        
        .checklist {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .checklist-category {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #e2e8f0;
        }
        
        .checklist-category h4 {
            color: #667eea;
            margin-bottom: 15px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 5px;
        }
        
        .checklist-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            padding: 5px;
            border-radius: 5px;
            transition: background 0.3s ease;
        }
        
        .checklist-item:hover {
            background: #e2e8f0;
        }
        
        .checklist-item input[type="checkbox"] {
            margin-right: 10px;
            transform: scale(1.2);
        }
        
        .weather-widget {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
            margin: 5px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .adjustment-panel {
            background: #fff5f5;
            border: 2px dashed #fed7d7;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .total-cost {
            background: linear-gradient(135deg, #48bb78, #38a169);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            font-size: 1.5em;
            margin: 20px 0;
        }
        
        .map-link-panel {
            background: #fff8dc;
            border: 2px dashed #ffd700;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
        }
        
        .map-link {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 10px 20px;
            text-decoration: none;
            border-radius: 5px;
            transition: background 0.3s ease;
        }
        
        .map-link:hover {
            background: #5a67d8;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .trip-overview {
                grid-template-columns: 1fr;
            }
        }
        
        /* ç¼–è¾‘æ¨¡å¼æ ·å¼ */
        .day-card.editing {
            border: 2px dashed #667eea !important;
            background: #f8f9ff;
            position: relative;
        }
        
        .day-card.editing [contenteditable="true"]:focus {
            background: #fff !important;
            border-color: #667eea !important;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
        }
        
        .delete-day-btn {
            transition: all 0.3s ease;
        }
        
        .delete-day-btn:hover {
            background: #c82333 !important;
            transform: scale(1.1);
        }
        
        .edit-controls {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .edit-help {
            background: #e3f2fd;
            border: 1px solid #bbdefb;
            border-radius: 8px;
            padding: 12px;
            margin: 15px 0;
            font-size: 14px;
            color: #1565c0;
        }
        
        .edit-help strong {
            color: #0d47a1;
        }
        
        @keyframes editModeEnter {
            from {
                background: #fff;
                border: 1px solid #e2e8f0;
            }
            to {
                background: #f8f9ff;
                border: 2px dashed #667eea;
            }
        }
        
        .day-card.editing {
            animation: editModeEnter 0.3s ease-in-out;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš— æ”¾é£è‡ªæˆ‘Â·æ¢¦æƒ³æ°¸é©»</h1>
            <p>æ–°ç–†è‡ªé©¾30å¤©æ·±åº¦æ¸¸ | 2024å¹´6æœˆ10æ—¥-7æœˆ9æ—¥</p>
        </div>

        <!-- è¡Œç¨‹æ¦‚è§ˆ -->
        <div class="card">
            <h2>ğŸŒŸ è¡Œç¨‹æ¦‚è§ˆ</h2>
            <div class="trip-overview">
                <div class="overview-item">
                    <h3>ğŸ‘¥ å›¢é˜Ÿè§„æ¨¡</h3>
                    <p>5äººå›¢é˜Ÿ (3ç”·2å¥³)</p>
                </div>
                <div class="overview-item">
                    <h3>ğŸš™ äº¤é€šå·¥å…·</h3>
                    <p>å²šå›¾æ¢¦æƒ³å®¶ (ç¥å·ç§Ÿè½¦)</p>
                </div>
                <div class="overview-item">
                    <h3>ğŸ“… å‡ºè¡Œæ—¶é—´</h3>
                    <p>30å¤© (å«3å¤©ç¼“å†²)</p>
                </div>
                <div class="overview-item">
                    <h3>ğŸ›£ï¸ æ€»é‡Œç¨‹</h3>
                    <p>çº¦11,554å…¬é‡Œ</p>
                </div>
            </div>
        </div>

        <!-- é«˜å¾·åœ°å›¾ -->
        <div class="card">
            <h2>ğŸ—ºï¸ è¡Œç¨‹è·¯çº¿å›¾</h2>
            <div id="mapContainer" class="map-container"></div>
            <div style="text-align: center; margin-top: 15px;">
                <button class="btn" onclick="showRoute()">ğŸ“ æ˜¾ç¤ºå®Œæ•´è·¯çº¿</button>
                <button class="btn" onclick="showCurrentLocation()">ğŸ“± å®šä½å½“å‰ä½ç½®</button>
                <button class="btn" onclick="openAmapApp()">ğŸš— æ‰“å¼€é«˜å¾·å¯¼èˆª</button>
                <button class="btn" onclick="clearRoute()">ğŸ—‘ï¸ æ¸…é™¤è·¯çº¿</button>
                <button class="btn" onclick="focusOnXinjiang()">ğŸ¯ èšç„¦æ–°ç–†</button>
            </div>
            
            <!-- é«˜å¾·åœ°å›¾ä¸ªäººè·¯çº¿å›¾é“¾æ¥ -->
            <div class="map-link-panel">
                <h4 style="color: #667eea; margin-bottom: 10px;">ğŸ”— é«˜å¾·åœ°å›¾ä¸ªäººè·¯çº¿å›¾</h4>
                <p style="margin-bottom: 10px;">ç‚¹å‡»ä¸‹æ–¹é“¾æ¥åœ¨é«˜å¾·åœ°å›¾APPä¸­æŸ¥çœ‹å®Œæ•´è·¯çº¿ï¼š</p>
                <a href="amapuri://workInAmap/createWithToken?polymericId=mcp_74ef3936e7fa4163acf05f4e8201a0bc&from=MCP" 
                   class="map-link">
                    ğŸ—ºï¸ åœ¨é«˜å¾·åœ°å›¾ä¸­æ‰“å¼€è·¯çº¿
                </a>
            </div>
        </div>

        <!-- è¯¦ç»†è¡Œç¨‹ -->
        <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2>ğŸ“‹ è¯¦ç»†è¡Œç¨‹å®‰æ’</h2>
                <div>
                    <button class="btn" onclick="toggleEditMode()" id="editBtn">âœï¸ ç¼–è¾‘è¡Œç¨‹</button>
                    <button class="btn" onclick="saveItinerary()" id="saveBtn" style="display: none; background: #28a745;">ğŸ’¾ ä¿å­˜</button>
                    <button class="btn" onclick="cancelEdit()" id="cancelBtn" style="display: none; background: #6c757d;">âŒ å–æ¶ˆ</button>
                    <button class="btn" onclick="addNewDay()" id="addDayBtn" style="display: none; background: #17a2b8;">â• æ·»åŠ ä¸€å¤©</button>
                </div>
            </div>
            
            <!-- ç¼–è¾‘æ¨¡å¼è¯´æ˜ -->
            <div class="edit-help" id="editHelp" style="display: none;">
                <strong>ğŸ“ ç¼–è¾‘è¯´æ˜ï¼š</strong>
                <ul style="margin: 8px 0; padding-left: 20px;">
                    <li>ç‚¹å‡»ä»»æ„æ–‡æœ¬æ¡†å¯ç›´æ¥ç¼–è¾‘å†…å®¹</li>
                    <li>ç‚¹å‡»å³ä¸Šè§’ ğŸ—‘ï¸ æŒ‰é’®å¯åˆ é™¤è¯¥å¤©è¡Œç¨‹</li>
                    <li>ç‚¹å‡»"â• æ·»åŠ ä¸€å¤©"å¯å¢åŠ æ–°çš„è¡Œç¨‹</li>
                    <li>ä¿®æ”¹å®Œæˆåç‚¹å‡»"ğŸ’¾ ä¿å­˜"ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨é‡æ–°è®¡ç®—è´¹ç”¨</li>
                    <li>æ‰€æœ‰ä¿®æ”¹ä¼šä¿å­˜åˆ°æµè§ˆå™¨æœ¬åœ°ï¼Œä¸‹æ¬¡æ‰“å¼€æ—¶è‡ªåŠ¨åŠ è½½</li>
                </ul>
            </div>
            
            <div class="itinerary" id="itinerary">
                <div class="day-card">
                    <div class="day-number">ç¬¬1å¤© (6æœˆ10æ—¥)</div>
                    <div class="destination">æ·±åœ³å—å±±ä¸‡ç§‘äº‘åŸ â†’ æ¹–åŒ—è¥„é˜³</div>
                    <div class="activities">ğŸ›£ï¸ è¡Œé©¶çº¦1267å…¬é‡Œï¼Œä½å®¿è¥„é˜³å…¨å­£é…’åº—</div>
                </div>
                <div class="day-card">
                    <div class="day-number">ç¬¬2å¤© (6æœˆ11æ—¥)</div>
                    <div class="destination">è¥„é˜³ â†’ å…°å·å¸‚</div>
                    <div class="activities">ğŸ›£ï¸ è¡Œé©¶çº¦1101å…¬é‡Œï¼Œå“å°æ­£å®—å…°å·ç‰›è‚‰é¢å’Œè¾£å­çƒ¤è‚‰ (ç´¯è®¡ï¼š2368km)</div>
                </div>
                <div class="day-card">
                    <div class="day-number">ç¬¬3å¤© (6æœˆ12æ—¥)</div>
                    <div class="destination">å…°å· â†’ ç”˜è‚ƒæ•¦ç…Œ</div>
                    <div class="activities">ğŸ›£ï¸ è¡Œé©¶çº¦1093å…¬é‡Œï¼Œç©¿è¶Šæ²³è¥¿èµ°å»Šï¼Œæ„Ÿå—ä¸è·¯é£æƒ… (ç´¯è®¡ï¼š3461km)</div>
                </div>
                <div class="day-card">
                    <div class="day-number">ç¬¬4å¤© (6æœˆ13æ—¥)</div>
                    <div class="destination">æ•¦ç…Œä¸€æ—¥æ¸¸</div>
                    <div class="activities">ğŸœï¸ é¸£æ²™å±±æœˆç‰™æ³‰ + ğŸ›ï¸ è«é«˜çªŸ (å¸‚å†…æ¸¸è§ˆçº¦50km)</div>
                </div>
                <div class="day-card">
                    <div class="day-number">ç¬¬5å¤© (6æœˆ14æ—¥)</div>
                    <div class="destination">æ•¦ç…Œ â†’ åé²ç•ª</div>
                    <div class="activities">ğŸ›£ï¸ è¡Œé©¶çº¦793å…¬é‡Œï¼Œæ­£å¼è¿›å…¥æ–°ç–†ï¼Œæ„Ÿå—è¥¿åŸŸé£æƒ… (ç´¯è®¡ï¼š4304km)</div>
                </div>
                <div class="day-card">
                    <div class="day-number">ç¬¬6å¤© (6æœˆ15æ—¥)</div>
                    <div class="destination">åé²ç•ª â†’ ä¹Œé²æœ¨é½</div>
                    <div class="activities">ğŸ›£ï¸ è¡Œé©¶çº¦220å…¬é‡Œï¼ŒğŸ‡ è‘¡è„æ²Ÿ + ğŸ”¥ ç«ç„°å±± + ğŸ›ï¸ äº¤æ²³æ•…åŸ (ç´¯è®¡ï¼š4524km)</div>
                </div>
                <div class="day-card">
                    <div class="day-number">ç¬¬7å¤© (6æœˆ16æ—¥)</div>
                    <div class="destination">ä¹Œé²æœ¨é½ â†’ é˜¿å…‹è‹æ¸©å®¿å¿</div>
                    <div class="activities">ğŸ›£ï¸ è¡Œé©¶çº¦880å…¬é‡Œï¼Œå—ç–†ä¹‹æ—…æ­£å¼å¼€å§‹ (ç´¯è®¡ï¼š5404km)</div>
                </div>
                <div class="day-card">
                    <div class="day-number">ç¬¬8å¤© (6æœˆ17æ—¥)</div>
                    <div class="destination">æ¸©å®¿å¤§å³¡è°·</div>
                    <div class="activities">ğŸ”ï¸ æ¢ç´¢ä¸­å›½å¤§å³¡è°·ç¾¤è½çš„å…¸å‹ä»£è¡¨ (å¸‚å†…æ¸¸è§ˆçº¦60km)</div>
                </div>
                <div class="day-card">
                    <div class="day-number">ç¬¬9å¤© (6æœˆ18æ—¥)</div>
                    <div class="destination">æ¸©å®¿ â†’ éº¦ç›–æå¿</div>
                    <div class="activities">ğŸ›£ï¸ è¡Œé©¶çº¦300å…¬é‡Œï¼Œæ·±å…¥å—ç–†è…¹åœ° (ç´¯è®¡ï¼š5764km)</div>
                </div>
                <div class="day-card">
                    <div class="day-number">ç¬¬10å¤© (6æœˆ19æ—¥)</div>
                    <div class="destination">éº¦ç›–æ â†’ å–€ä»€å¸‚</div>
                    <div class="activities">ğŸ›£ï¸ è¡Œé©¶çº¦480å…¬é‡Œï¼ŒæŠµè¾¾å—ç–†é‡é•‡å–€ä»€ (ç´¯è®¡ï¼š6244km)</div>
                </div>
                <div class="day-card">
                    <div class="day-number">ç¬¬11å¤© (6æœˆ20æ—¥)</div>
                    <div class="destination">å–€ä»€ â†’ å¡”ä»€åº“å°”å¹²å¿</div>
                    <div class="activities">ğŸ›£ï¸ è¡Œé©¶çº¦290å…¬é‡Œï¼ŒğŸ”ï¸ é€”å¾„ç™½æ²™æ¹–ã€æ…•å£«å¡”æ ¼å³° (ç´¯è®¡ï¼š6534km)</div>
                </div>
                <div class="day-card">
                    <div class="day-number">ç¬¬12å¤© (6æœˆ21æ—¥)</div>
                    <div class="destination">å¡”å¿ â†’ çº¢å…¶æ‹‰ç”«å£å²¸ â†’ å¡”å¿</div>
                    <div class="activities">ğŸ›£ï¸ å¾€è¿”çº¦240å…¬é‡Œï¼ŒğŸš© ä¸­å·´è¾¹å¢ƒï¼Œæµ·æ‹”4700ç±³ (ç´¯è®¡ï¼š6774km)</div>
                </div>
                <div class="day-card">
                    <div class="day-number">ç¬¬13å¤© (6æœˆ22æ—¥)</div>
                    <div class="destination">å¡”å¿ â†’ å–€ä»€å¸‚</div>
                    <div class="activities">ğŸ›£ï¸ è¡Œé©¶çº¦290å…¬é‡Œï¼Œè¿”å›å–€ä»€ (ç´¯è®¡ï¼š7064km)</div>
                </div>
                <div class="day-card">
                    <div class="day-number">ç¬¬14å¤© (6æœˆ23æ—¥)</div>
                    <div class="destination">å–€ä»€ â†’ å’Œç”°å¸‚</div>
                    <div class="activities">ğŸ›£ï¸ è¡Œé©¶çº¦500å…¬é‡Œï¼Œæ²¿å¡”å…‹æ‹‰ç›å¹²æ²™æ¼ è¾¹ç¼˜å‰è¡Œ (ç´¯è®¡ï¼š7564km)</div>
                </div>
                <div class="day-card">
                    <div class="day-number">ç¬¬15å¤© (6æœˆ24æ—¥)</div>
                    <div class="destination">å’Œç”° â†’ åº“è½¦</div>
                    <div class="activities">ğŸ›£ï¸ è¡Œé©¶çº¦650å…¬é‡Œï¼Œå‡†å¤‡è¿æ¥ç‹¬åº“å…¬è·¯ä¹‹æ—… (ç´¯è®¡ï¼š8214km)</div>
                </div>
                <div class="day-card">
                    <div class="day-number">ç¬¬16å¤© (6æœˆ25æ—¥)</div>
                    <div class="destination">åº“è½¦ â†’ é‚£æ‹‰æè‰åŸ</div>
                    <div class="activities">ğŸ›£ï¸ è¡Œé©¶çº¦280å…¬é‡Œï¼ŒğŸ›£ï¸ ä¸­å›½æœ€ç¾å…¬è·¯ä¹‹ä¸€ - ç‹¬åº“å…¬è·¯ (ç´¯è®¡ï¼š8494km)</div>
                </div>
                <div class="day-card">
                    <div class="day-number">ç¬¬17å¤© (6æœˆ26æ—¥)</div>
                    <div class="destination">é‚£æ‹‰æ â†’ ç‰¹å…‹æ–¯</div>
                    <div class="activities">ğŸ›£ï¸ è¡Œé©¶çº¦150å…¬é‡Œï¼ŒğŸŒ± è¾½é˜”è‰åŸç¾æ™¯ (ç´¯è®¡ï¼š8644km)</div>
                </div>
                <div class="day-card">
                    <div class="day-number">ç¬¬18å¤© (6æœˆ27æ—¥)</div>
                    <div class="destination">ç‰¹å…‹æ–¯ â†’ æ˜­è‹ â†’ ä¼Šå®</div>
                    <div class="activities">ğŸ›£ï¸ è¡Œé©¶çº¦260å…¬é‡Œï¼ŒğŸŒ² å¤å¡”å¤é“æ£®æ—å…¬å›­ (ç´¯è®¡ï¼š8904km)</div>
                </div>
                <div class="day-card">
                    <div class="day-number">ç¬¬19å¤© (6æœˆ28æ—¥)</div>
                    <div class="destination">ä¼Šå®å¸‚ä¼‘æ•´æˆ–è‡ªç”±æ´»åŠ¨</div>
                    <div class="activities">ğŸª ä½“éªŒç»´å¾å°”æ—æ–‡åŒ– (å¸‚å†…æ¸¸è§ˆçº¦50km)</div>
                </div>
                <div class="day-card">
                    <div class="day-number">ç¬¬20å¤© (6æœˆ29æ—¥)</div>
                    <div class="destination">ä¼Šå® â†’ èµ›é‡Œæœ¨æ¹– â†’ åšä¹</div>
                    <div class="activities">ğŸ›£ï¸ è¡Œé©¶çº¦120å…¬é‡Œï¼ŒğŸ’™ å¤§è¥¿æ´‹æœ€åä¸€æ»´çœ¼æ³ª (ç´¯è®¡ï¼š9074km)</div>
                </div>
                <div class="day-card">
                    <div class="day-number">ç¬¬21å¤© (6æœˆ30æ—¥)</div>
                    <div class="destination">åšä¹ â†’ çŸ³æ²³å­</div>
                    <div class="activities">ğŸ›£ï¸ è¡Œé©¶çº¦480å…¬é‡Œï¼ŒğŸŒˆ é€”å¾„å®‰é›†æµ·å¤§å³¡è°· (ç´¯è®¡ï¼š9554km)</div>
                </div>
                <div class="day-card">
                    <div class="day-number">ç¬¬22å¤© (7æœˆ1æ—¥)</div>
                    <div class="destination">çŸ³æ²³å­ â†’ å¸ƒå°”æ´¥</div>
                    <div class="activities">ğŸŒ… é€”å¾„äº”å½©æ»©ï¼ŒåŒ—ç–†ä¹‹æ—…å¼€å§‹</div>
                </div>
                <div class="day-card">
                    <div class="day-number">ç¬¬23å¤© (7æœˆ2æ—¥)</div>
                    <div class="destination">å¸ƒå°”æ´¥ â†’ ç¦¾æœ¨æ‘</div>
                    <div class="activities">ğŸ˜ï¸ ä¸­å›½æœ€ç¾æ‘åº„</div>
                </div>
                <div class="day-card">
                    <div class="day-number">ç¬¬24å¤© (7æœˆ3æ—¥)</div>
                    <div class="destination">ç¦¾æœ¨ â†’ å–€çº³æ–¯æ¹– â†’ å¸ƒå°”æ´¥</div>
                    <div class="activities">ğŸ”ï¸ ç¥çš„åèŠ±å›­</div>
                </div>
                <div class="day-card">
                    <div class="day-number">ç¬¬25å¤© (7æœˆ4æ—¥)</div>
                    <div class="destination">å¸ƒå°”æ´¥ â†’ ä¹Œé²æœ¨é½</div>
                    <div class="activities">è¿”å›æ–°ç–†é¦–åºœ</div>
                </div>
                <div class="day-card">
                    <div class="day-number">ç¬¬26å¤© (7æœˆ5æ—¥)</div>
                    <div class="destination">ä¹Œé²æœ¨é½ â†’ å¤©å±±å¤©æ±  â†’ å¥‡å°å¿</div>
                    <div class="activities">ğŸ”ï¸ å¤©å±±æ˜ç </div>
                </div>
                <div class="day-card">
                    <div class="day-number">ç¬¬27å¤© (7æœˆ6æ—¥)</div>
                    <div class="destination">å¥‡å°å¿ â†’ æ±Ÿå¸ƒæ‹‰å…‹ â†’ æ˜Œå‰</div>
                    <div class="activities">ğŸŒ¾ ä¸‡äº©éº¦ç”°ç”»å·</div>
                </div>
                <div class="day-card">
                    <div class="day-number">ç¬¬28-30å¤© (7æœˆ7-9æ—¥)</div>
                    <div class="destination">æ˜Œå‰ â†’ ä¹Œé²æœ¨é½</div>
                    <div class="activities">ğŸš— è¿˜è½¦å‡†å¤‡ + ğŸš‚ ç«è½¦è¿”ç¨‹</div>
                </div>
            </div>
        </div>

        <!-- è´¹ç”¨ä¼°ç®— -->
        <div class="card">
            <h2>ğŸ’° è´¹ç”¨ä¼°ç®—æ˜ç»†</h2>
            <div class="cost-breakdown">
                <div class="cost-item">
                    <h4>ğŸš— ç§Ÿè½¦è´¹ç”¨</h4>
                    <div class="cost-amount">Â¥12,900</div>
                    <p>å²šå›¾æ¢¦æƒ³å®¶+å…¨é™© (30å¤©)</p>
                </div>
                <div class="cost-item">
                    <h4>â›½ æ²¹è´¹</h4>
                    <div class="cost-amount">Â¥6,070</div>
                    <p>11554km Ã— 7L/100km Ã— Â¥7.5/L</p>
                </div>
                <div class="cost-item">
                    <h4>ğŸ¨ ä½å®¿è´¹ç”¨</h4>
                    <div class="cost-amount">Â¥24,300</div>
                    <p>27æ™š Ã— 3é—´æˆ¿ Ã— Â¥300/é—´</p>
                </div>
                <div class="cost-item">
                    <h4>ğŸ« æ™¯ç‚¹é—¨ç¥¨</h4>
                    <div class="cost-amount">Â¥6,000</div>
                    <p>è«é«˜çªŸã€å–€çº³æ–¯ç­‰æ™¯ç‚¹</p>
                </div>
                <div class="cost-item">
                    <h4>ğŸ½ï¸ é¤é¥®è´¹ç”¨</h4>
                    <div class="cost-amount">Â¥9,000</div>
                    <p>5äºº Ã— 30å¤© Ã— Â¥60/äºº/å¤©</p>
                </div>
                <div class="cost-item">
                    <h4>ğŸš‚ è¿”ç¨‹ç«è½¦ç¥¨</h4>
                    <div class="cost-amount">Â¥3,500</div>
                    <p>ä¹Œé²æœ¨é½â†’å¹¿å· ç¡¬å§</p>
                </div>
                <div class="cost-item">
                    <h4>ğŸ›£ï¸ è¿‡è·¯è´¹</h4>
                    <div class="cost-amount">Â¥3,200</div>
                    <p>é«˜é€Ÿå…¬è·¯é€šè¡Œè´¹(æ›´æ–°)</p>
                </div>
                <div class="cost-item">
                    <h4>ğŸ“± å…¶ä»–è´¹ç”¨</h4>
                    <div class="cost-amount">Â¥2,000</div>
                    <p>é€šè®¯ã€åœè½¦ã€åº”æ€¥ç­‰</p>
                </div>
            </div>
            <div class="total-cost">
                ğŸ’ æ€»é¢„ç®—ï¼šÂ¥66,970 (äººå‡ Â¥13,394)
                <div style="font-size: 0.8em; margin-top: 10px; opacity: 0.9;">
                    ğŸ“Š åŸºäºå®é™…æ€»é‡Œç¨‹11,554å…¬é‡Œé‡æ–°è®¡ç®—
                </div>
            </div>
        </div>

        <!-- å‡ºå‘å‰å‡†å¤‡æ¸…å• -->
        <div class="card">
            <h2>ğŸ“ å‡ºå‘å‰å¿…å¤‡ç‰©å“æ¸…å•</h2>
            <div class="checklist">
                <div class="checklist-category">
                    <h4>ğŸ†” è¯ä»¶ç±»</h4>
                    <div class="checklist-item">
                        <input type="checkbox" id="id1"> <label for="id1">èº«ä»½è¯åŸä»¶ (5ä»½)</label>
                    </div>
                    <div class="checklist-item">
                        <input type="checkbox" id="id2"> <label for="id2">é©¾é©¶è¯åŸä»¶ (è‡³å°‘2æœ¬)</label>
                    </div>
                    <div class="checklist-item">
                        <input type="checkbox" id="id3"> <label for="id3">è¡Œé©¶è¯å¤å°ä»¶</label>
                    </div>
                    <div class="checklist-item">
                        <input type="checkbox" id="id4"> <label for="id4">ä¿é™©å•</label>
                    </div>
                    <div class="checklist-item">
                        <input type="checkbox" id="id5"> <label for="id5">é“¶è¡Œå¡å’Œç°é‡‘</label>
                    </div>
                </div>
                
                <div class="checklist-category">
                    <h4>ğŸš— è½¦è¾†ç”¨å“</h4>
                    <div class="checklist-item">
                        <input type="checkbox" id="car1"> <label for="car1">å¤‡èƒæ£€æŸ¥</label>
                    </div>
                    <div class="checklist-item">
                        <input type="checkbox" id="car2"> <label for="car2">åƒæ–¤é¡¶+æ‰³æ‰‹</label>
                    </div>
                    <div class="checklist-item">
                        <input type="checkbox" id="car3"> <label for="car3">è¡¥èƒå·¥å…·åŒ…</label>
                    </div>
                    <div class="checklist-item">
                        <input type="checkbox" id="car4"> <label for="car4">æœºæ²¹+å†·å´æ¶²</label>
                    </div>
                    <div class="checklist-item">
                        <input type="checkbox" id="car5"> <label for="car5">è½¦è½½å……ç”µå™¨</label>
                    </div>
                    <div class="checklist-item">
                        <input type="checkbox" id="car6"> <label for="car6">æ‹–è½¦ç»³</label>
                    </div>
                    <div class="checklist-item">
                        <input type="checkbox" id="car7"> <label for="car7">åå…‰ä¸‰è§’æ¶</label>
                    </div>
                </div>
                
                <div class="checklist-category">
                    <h4>ğŸ’Š åŒ»è¯ç”¨å“</h4>
                    <div class="checklist-item">
                        <input type="checkbox" id="med1"> <label for="med1">æ„Ÿå†’è¯</label>
                    </div>
                    <div class="checklist-item">
                        <input type="checkbox" id="med2"> <label for="med2">è‚ èƒƒè¯</label>
                    </div>
                    <div class="checklist-item">
                        <input type="checkbox" id="med3"> <label for="med3">é«˜åŸååº”è¯</label>
                    </div>
                    <div class="checklist-item">
                        <input type="checkbox" id="med4"> <label for="med4">åˆ›å¯è´´</label>
                    </div>
                    <div class="checklist-item">
                        <input type="checkbox" id="med5"> <label for="med5">æ¶ˆæ¯’ç”¨å“</label>
                    </div>
                    <div class="checklist-item">
                        <input type="checkbox" id="med6"> <label for="med6">é˜²æ™’éœœ</label>
                    </div>
                </div>
                
                <div class="checklist-category">
                    <h4>ğŸ¯ é£Ÿç‰©ç”¨å“</h4>
                    <div class="checklist-item">
                        <input type="checkbox" id="food1"> <label for="food1">é¥®ç”¨æ°´ (5ç®±)</label>
                    </div>
                    <div class="checklist-item">
                        <input type="checkbox" id="food2"> <label for="food2">æ–¹ä¾¿é¢ (1ç®±)</label>
                    </div>
                    <div class="checklist-item">
                        <input type="checkbox" id="food3"> <label for="food3">åšæœé›¶é£Ÿ</label>
                    </div>
                    <div class="checklist-item">
                        <input type="checkbox" id="food4"> <label for="food4">å‹ç¼©é¥¼å¹²</label>
                    </div>
                    <div class="checklist-item">
                        <input type="checkbox" id="food5"> <label for="food5">ä¿æ¸©ç›’é¥­ç›’</label>
                    </div>
                </div>
                
                <div class="checklist-category">
                    <h4>ğŸ‘• æœè£…ç”¨å“</h4>
                    <div class="checklist-item">
                        <input type="checkbox" id="cloth1"> <label for="cloth1">å†²é”‹è¡£ (äººæ‰‹ä¸€ä»¶)</label>
                    </div>
                    <div class="checklist-item">
                        <input type="checkbox" id="cloth2"> <label for="cloth2">ä¿æš–å†…è¡£</label>
                    </div>
                    <div class="checklist-item">
                        <input type="checkbox" id="cloth3"> <label for="cloth3">èˆ’é€‚è¿åŠ¨é‹</label>
                    </div>
                    <div class="checklist-item">
                        <input type="checkbox" id="cloth4"> <label for="cloth4">å¤ªé˜³å¸½å¢¨é•œ</label>
                    </div>
                    <div class="checklist-item">
                        <input type="checkbox" id="cloth5"> <label for="cloth5">æ¢æ´—è¡£ç‰©</label>
                    </div>
                </div>
                
                <div class="checklist-category">
                    <h4>ğŸ“± ç”µå­è®¾å¤‡</h4>
                    <div class="checklist-item">
                        <input type="checkbox" id="elec1"> <label for="elec1">æ‰‹æœºå……ç”µå®</label>
                    </div>
                    <div class="checklist-item">
                        <input type="checkbox" id="elec2"> <label for="elec2">ç›¸æœº+å­˜å‚¨å¡</label>
                    </div>
                    <div class="checklist-item">
                        <input type="checkbox" id="elec3"> <label for="elec3">å¯¼èˆªè®¾å¤‡</label>
                    </div>
                    <div class="checklist-item">
                        <input type="checkbox" id="elec4"> <label for="elec4">å¯¹è®²æœº (2å°)</label>
                    </div>
                    <div class="checklist-item">
                        <input type="checkbox" id="elec5"> <label for="elec5">æ‰‹ç”µç­’</label>
                    </div>
                </div>
            </div>
        </div>

        <!-- å¤©æ°”é¢„è­¦ -->
        <div class="card">
            <h2>ğŸŒ¤ï¸ å¤©æ°”çŠ¶å†µé¢„è­¦</h2>
            <div class="weather-widget">
                <h3>6æœˆæ–°ç–†å¤©æ°”ç‰¹ç‚¹</h3>
                <p>â˜€ï¸ ç™½å¤©æ¸©åº¦ï¼š15-30Â°C | ğŸŒ™ å¤œæ™šæ¸©åº¦ï¼š5-15Â°C</p>
                <p>ğŸ”ï¸ é«˜æµ·æ‹”åœ°åŒºæ¸©å·®å¤§ï¼Œéœ€å¤‡é½ä¿æš–è¡£ç‰©</p>
                <p>ğŸŒ§ï¸ å±±åŒºå¤šé›·é˜µé›¨ï¼Œæ³¨æ„é˜²é›¨</p>
            </div>
        </div>

        <!-- è®¡åˆ’è°ƒæ•´é¢æ¿ -->
        <div class="card">
            <h2>âš™ï¸ è¡Œç¨‹è°ƒæ•´</h2>
            <div class="adjustment-panel">
                <p>ğŸ’¡ <strong>çµæ´»è°ƒæ•´æç¤ºï¼š</strong></p>
                <p>â€¢ è¡Œç¨‹é¢„ç•™3å¤©ç¼“å†²æ—¶é—´ï¼Œå¯æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´</p>
                <p>â€¢ å¦‚é‡æ¶åŠ£å¤©æ°”ï¼Œå¯å»¶å1-2å¤©å‡ºå‘</p>
                <p>â€¢ é‡ç‚¹æ™¯åŒºå»ºè®®å¤šé¢„ç•™æ—¶é—´ï¼ˆå–€çº³æ–¯ã€ç‹¬åº“å…¬è·¯ç­‰ï¼‰</p>
                <div style="margin-top: 15px;">
                    <button class="btn" onclick="adjustItinerary()">ğŸ“ è°ƒæ•´è¡Œç¨‹</button>
                    <button class="btn" onclick="recalculateCost()">ğŸ’° é‡æ–°è®¡ç®—è´¹ç”¨</button>
                    <button class="btn" onclick="exportPlan()">ğŸ“„ å¯¼å‡ºæ”»ç•¥</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // é«˜å¾·åœ°å›¾åˆå§‹åŒ–
        let map;
        let driving;
        let mapLoadAttempts = 0;
        const maxAttempts = 3;
        
        function initMap() {
            mapLoadAttempts++;
            console.log(`åœ°å›¾åˆå§‹åŒ–å°è¯• ${mapLoadAttempts}/${maxAttempts}`);
            
            try {
                // æ£€æŸ¥AMapæ˜¯å¦åŠ è½½æˆåŠŸ
                if (typeof AMap === 'undefined') {
                    throw new Error('é«˜å¾·åœ°å›¾APIæœªåŠ è½½');
                }
                
                // ä½¿ç”¨æœ€åŸºç¡€çš„åœ°å›¾é…ç½®
                map = new AMap.Map('mapContainer', {
                    zoom: 5,
                    center: [87.616824, 43.825377],
                    resizeEnable: true,
                    dragEnable: true,
                    zoomEnable: true,
                    doubleClickZoom: true,
                    keyboardEnable: true,
                    scrollWheel: true
                });
                
                // ç­‰åœ°å›¾å®Œå…¨åŠ è½½åå†æ·»åŠ æ§ä»¶
                map.on('complete', function() {
                    console.log('åœ°å›¾åŠ è½½å®Œæˆ');
                    updateMapStatus('success', 'åœ°å›¾åŠ è½½æˆåŠŸï¼');
                    
                    // åˆå§‹åŒ–å…¨å±€å˜é‡
                    if (!window.currentRoutes) {
                        window.currentRoutes = [];
                    }
                    if (!window.mapMarkers) {
                        window.mapMarkers = [];
                    }
                    
                    // æ·»åŠ æ¬¢è¿æç¤º
                    setTimeout(() => {
                        showWelcomeMessage();
                    }, 1000);
                });
                
                // åœ°å›¾åŠ è½½é”™è¯¯å¤„ç†
                map.on('error', function(error) {
                    console.error('åœ°å›¾åŠ è½½é”™è¯¯:', error);
                    updateMapStatus('error', 'åœ°å›¾åŠ è½½å‡ºé”™ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
                });
                
            } catch (error) {
                console.error('åœ°å›¾åˆå§‹åŒ–å¤±è´¥:', error);
                if (mapLoadAttempts < maxAttempts) {
                    updateMapStatus('retry', `åœ°å›¾åŠ è½½å¤±è´¥ï¼Œæ­£åœ¨é‡è¯• (${mapLoadAttempts}/${maxAttempts})...`);
                    setTimeout(() => {
                        initMap();
                    }, 2000);
                } else {
                    updateMapStatus('failed', 'åœ°å›¾åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–åˆ·æ–°é¡µé¢');
                }
            }
        }
        
        function updateMapStatus(status, message) {
            const mapContainer = document.getElementById('mapContainer');
            let statusDiv = mapContainer.querySelector('.map-status');
            
            if (!statusDiv) {
                statusDiv = document.createElement('div');
                statusDiv.className = 'map-status';
                statusDiv.style.cssText = `
                    position: absolute;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    padding: 20px;
                    border-radius: 10px;
                    text-align: center;
                    z-index: 1000;
                    font-family: Arial, sans-serif;
                `;
                mapContainer.appendChild(statusDiv);
            }
            
            switch (status) {
                case 'loading':
                    statusDiv.style.background = 'linear-gradient(135deg, #74b9ff, #0984e3)';
                    statusDiv.style.color = 'white';
                    statusDiv.innerHTML = `
                        <div style="display: flex; align-items: center; justify-content: center;">
                            <div style="margin-right: 10px;">ğŸ—ºï¸</div>
                            <div>${message}</div>
                        </div>
                        <div style="margin-top: 10px; font-size: 12px;">è¯·ç¨å€™...</div>
                    `;
                    break;
                case 'retry':
                    statusDiv.style.background = 'linear-gradient(135deg, #fdcb6e, #e17055)';
                    statusDiv.style.color = 'white';
                    statusDiv.innerHTML = `
                        <div style="display: flex; align-items: center; justify-content: center;">
                            <div style="margin-right: 10px;">ğŸ”„</div>
                            <div>${message}</div>
                        </div>
                    `;
                    break;
                case 'error':
                case 'failed':
                    statusDiv.style.background = 'linear-gradient(135deg, #ff6b6b, #ee5a52)';
                    statusDiv.style.color = 'white';
                    statusDiv.innerHTML = `
                        <div style="display: flex; align-items: center; justify-content: center;">
                            <div style="margin-right: 10px;">âŒ</div>
                            <div>${message}</div>
                        </div>
                        <div style="margin: 15px 0; padding: 10px; background: rgba(255,255,255,0.2); border-radius: 5px;">
                            <p style="margin: 5px 0; font-size: 14px;">å¯èƒ½çš„è§£å†³æ–¹æ¡ˆï¼š</p>
                            <ul style="margin: 0; padding-left: 20px; font-size: 12px; text-align: left;">
                                <li>æ£€æŸ¥ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸</li>
                                <li>ç¡®è®¤APIå¯†é’¥æ˜¯å¦æœ‰æ•ˆ</li>
                                <li>å°è¯•åˆ·æ–°é¡µé¢é‡æ–°åŠ è½½</li>
                                <li>æ¸…é™¤æµè§ˆå™¨ç¼“å­˜åé‡è¯•</li>
                            </ul>
                        </div>
                        <div style="display: flex; gap: 10px; justify-content: center;">
                            <button onclick="location.reload()" style="
                                padding: 8px 16px;
                                background: white;
                                color: #ff6b6b;
                                border: none;
                                border-radius: 5px;
                                cursor: pointer;
                                font-weight: bold;
                            ">ğŸ”„ åˆ·æ–°é¡µé¢</button>
                            <button onclick="showBackupMap()" style="
                                padding: 8px 16px;
                                background: rgba(255,255,255,0.2);
                                color: white;
                                border: 1px solid white;
                                border-radius: 5px;
                                cursor: pointer;
                                font-weight: bold;
                            ">ğŸ“‹ æŸ¥çœ‹è¡Œç¨‹è¡¨</button>
                        </div>
                    `;
                    break;
                case 'success':
                    statusDiv.style.background = 'linear-gradient(135deg, #00b894, #00a085)';
                    statusDiv.style.color = 'white';
                    statusDiv.innerHTML = `
                        <div style="display: flex; align-items: center; justify-content: center;">
                            <div style="margin-right: 10px;">âœ…</div>
                            <div>${message}</div>
                        </div>
                    `;
                    setTimeout(() => {
                        if (statusDiv && statusDiv.parentNode) {
                            statusDiv.parentNode.removeChild(statusDiv);
                        }
                    }, 2000);
                    break;
            }
        }
        
        function showWelcomeMessage() {
            const welcomeDiv = document.createElement('div');
            welcomeDiv.style.cssText = `
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                padding: 20px 30px;
                border-radius: 15px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                z-index: 1000;
                text-align: center;
                animation: fadeInOut 3s ease-in-out;
                font-family: Arial, sans-serif;
            `;
            welcomeDiv.innerHTML = `
                <h3 style="margin: 0 0 10px 0;">ğŸ‰ æ¬¢è¿æŸ¥çœ‹è¡Œç¨‹è·¯çº¿</h3>
                <p style="margin: 0;">ç‚¹å‡»"æ˜¾ç¤ºå®Œæ•´è·¯çº¿"æŒ‰é’®æŸ¥çœ‹å®Œæ•´è¡Œç¨‹</p>
            `;
            
            // æ·»åŠ CSSåŠ¨ç”»
            const style = document.createElement('style');
            style.textContent = `
                @keyframes fadeInOut {
                    0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
                    20% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                    80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                    100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
                }
            `;
            document.head.appendChild(style);
            
            document.getElementById('mapContainer').appendChild(welcomeDiv);
            
            setTimeout(() => {
                if (welcomeDiv.parentNode) {
                    welcomeDiv.parentNode.removeChild(welcomeDiv);
                }
            }, 3000);
        }
        
        function addMarkers() {
            const locations = [
                {name: 'æ·±åœ³ä¸‡ç§‘äº‘åŸ', lnglat: [113.943361, 22.574414], day: 1, date: '6æœˆ10æ—¥', type: 'start', distance: 0},
                {name: 'è¥„é˜³', lnglat: [112.121743, 32.010161], day: 1, date: '6æœˆ10æ—¥æ™š', type: 'stop', distance: 1000},
                {name: 'å…°å·', lnglat: [103.834228, 36.060798], day: 2, date: '6æœˆ11æ—¥', type: 'stop', distance: 700},
                {name: 'æ•¦ç…Œ', lnglat: [94.662010, 40.142141], day: 3, date: '6æœˆ12æ—¥', type: 'scenic', distance: 530},
                {name: 'åé²ç•ª', lnglat: [89.190374, 42.950736], day: 5, date: '6æœˆ14æ—¥', type: 'scenic', distance: 430},
                {name: 'æ¸©å®¿å¿', lnglat: [80.231234, 41.275591], day: 7, date: '6æœˆ16æ—¥', type: 'stop', distance: 460},
                {name: 'éº¦ç›–æå¿', lnglat: [77.651557, 38.906053], day: 9, date: '6æœˆ18æ—¥', type: 'stop', distance: 300},
                {name: 'å–€ä»€', lnglat: [75.989755, 39.467664], day: 10, date: '6æœˆ19æ—¥', type: 'major', distance: 260},
                {name: 'å¡”ä»€åº“å°”å¹²', lnglat: [75.226568, 37.775493], day: 11, date: '6æœˆ20æ—¥', type: 'scenic', distance: 290},
                {name: 'çº¢å…¶æ‹‰ç”«å£å²¸', lnglat: [74.898102, 37.027333], day: 12, date: '6æœˆ21æ—¥', type: 'border', distance: 120},
                {name: 'å’Œç”°', lnglat: [79.916569, 37.111694], day: 14, date: '6æœˆ23æ—¥', type: 'stop', distance: 500},
                {name: 'åº“è½¦', lnglat: [82.964688, 41.717397], day: 15, date: '6æœˆ24æ—¥', type: 'stop', distance: 650},
                {name: 'ç‹¬åº“å…¬è·¯', lnglat: [83.672842, 42.958008], day: 16, date: '6æœˆ25æ—¥', type: 'scenic', distance: 280},
                {name: 'é‚£æ‹‰æè‰åŸ', lnglat: [83.396029, 43.331634], day: 17},
                {name: 'ç‰¹å…‹æ–¯', lnglat: [81.843773, 43.217651], day: 17},
                {name: 'ä¼Šå®', lnglat: [81.324084, 43.916912], day: 18},
                {name: 'èµ›é‡Œæœ¨æ¹–', lnglat: [81.171875, 44.599572], day: 20},
                {name: 'åšä¹', lnglat: [82.066940, 44.902887], day: 20},
                {name: 'çŸ³æ²³å­', lnglat: [86.041075, 44.305886], day: 21},
                {name: 'å¸ƒå°”æ´¥', lnglat: [86.861007, 47.704351], day: 22},
                {name: 'ç¦¾æœ¨æ‘', lnglat: [87.043991, 48.671741], day: 23},
                {name: 'å–€çº³æ–¯æ¹–', lnglat: [87.027588, 48.707888], day: 24},
                {name: 'ä¹Œé²æœ¨é½', lnglat: [87.616824, 43.825377], day: 25}, // æ³¨æ„ï¼šä»å–€çº³æ–¯å›åˆ°å¸ƒå°”æ´¥å†åˆ°ä¹Œå¸‚
                {name: 'å¤©å±±å¤©æ± ', lnglat: [88.126953, 43.883411], day: 26},
                {name: 'å¥‡å°å¿', lnglat: [89.574710, 44.018347], day: 26},
                {name: 'æ±Ÿå¸ƒæ‹‰å…‹', lnglat: [89.676208, 44.162178], day: 27},
                {name: 'æ˜Œå‰', lnglat: [87.308784, 44.014577], day: 27}
            ];
            
            // æ¸…é™¤ä¹‹å‰çš„æ ‡è®°
            if (window.mapMarkers) {
                window.mapMarkers.forEach(item => {
                    map.remove(item.marker);
                });
            }
            window.mapMarkers = [];
            
            locations.forEach((location, index) => {
                try {
                    // æ ¹æ®ç±»å‹è®¾ç½®ä¸åŒçš„æ ‡è®°é¢œè‰²
                    let labelBg = '#1E90FF';
                    
                    switch(location.type) {
                        case 'start':
                            labelBg = '#28a745';
                            break;
                        case 'major':
                            labelBg = '#dc3545';
                            break;
                        case 'scenic':
                            labelBg = '#ffc107';
                            break;
                        case 'border':
                            labelBg = '#6f42c1';
                            break;
                        default:
                            labelBg = '#1E90FF';
                    }
                    
                    // åˆ›å»ºæ ‡è®°å†…å®¹
                    let labelContent = `ç¬¬${location.day}å¤©`;
                    if (location.distance > 0) {
                        labelContent += `\n${location.distance}km`;
                    }
                    
                    // åˆ›å»ºæ ‡è®°
                    const marker = new AMap.Marker({
                        position: location.lnglat,
                        title: `ç¬¬${location.day}å¤©: ${location.name}`,
                        label: {
                            content: labelContent,
                            direction: 'center',
                            style: {
                                backgroundColor: labelBg,
                                color: 'white',
                                padding: '8px 12px',
                                borderRadius: '15px',
                                fontSize: '11px',
                                fontWeight: 'bold',
                                border: '2px solid white',
                                boxShadow: '0 2px 6px rgba(0,0,0,0.3)',
                                textAlign: 'center',
                                lineHeight: '1.2'
                            }
                        }
                    });
                    
                    // åˆ›å»ºä¿¡æ¯çª—ä½“
                    const infoWindow = new AMap.InfoWindow({
                        content: `
                            <div style="padding: 12px; min-width: 200px; font-family: Arial;">
                                <h4 style="margin: 0 0 8px 0; color: ${labelBg}; font-size: 16px;">
                                    ğŸ¯ ${location.name}
                                </h4>
                                <div style="margin: 5px 0; padding: 8px; background: #f8f9fa; border-radius: 5px;">
                                    <div style="margin: 3px 0;"><strong>ğŸ“… æ—¥æœŸ:</strong> ${location.date}</div>
                                    <div style="margin: 3px 0;"><strong>ğŸ›£ï¸ è¡Œç¨‹:</strong> ç¬¬${location.day}å¤©</div>
                                    ${location.distance > 0 ? `<div style="margin: 3px 0;"><strong>ğŸ“ è·ç¦»:</strong> ${location.distance}km</div>` : ''}
                                </div>
                                <div style="padding: 5px 10px; background: ${labelBg}; color: white; border-radius: 5px; text-align: center; margin-top: 8px;">
                                    ${getLocationTypeDesc(location.type)}
                                </div>
                            </div>
                        `,
                        offset: new AMap.Pixel(0, -40)
                    });
                    
                    marker.on('click', function() {
                        infoWindow.open(map, location.lnglat);
                    });
                    
                    marker.setMap(map);
                    
                    // å­˜å‚¨æ ‡è®°
                    window.mapMarkers.push({marker, location});
                    
                } catch (error) {
                    console.error(`æ ‡è®° ${location.name} åˆ›å»ºå¤±è´¥:`, error);
                }
            });
        }
        
        // è·å–åœ°ç‚¹ç±»å‹æè¿°
        function getLocationTypeDesc(type) {
            const typeMap = {
                'start': 'ğŸš— è¡Œç¨‹èµ·ç‚¹',
                'major': 'ğŸ™ï¸ é‡è¦åŸå¸‚',
                'scenic': 'ğŸï¸ æ™¯ç‚¹æ¸¸è§ˆ',
                'border': 'ğŸš© è¾¹å¢ƒå£å²¸',
                'stop': 'ğŸ¨ è¿‡å¤œåœç•™'
            };
            return typeMap[type] || 'ğŸ“ é€”ç»åœ°ç‚¹';
        }
        
        function showRoute() {
            console.log('=== æ˜¾ç¤ºæ–°ç–†è‡ªé©¾å®é™…è·¯çº¿ ===');
            
            // æ¸…é™¤ä¹‹å‰çš„è·¯çº¿
            if (window.currentRoutes) {
                window.currentRoutes.forEach(route => {
                    map.remove(route);
                });
            }
            window.currentRoutes = [];
            
            // æ·»åŠ å¸¦å®é™…é‡Œç¨‹çš„æ ‡è®°ç‚¹
            addMarkersWithRealDistance();
            
            showTip('æ­£åœ¨è§„åˆ’å®é™…é©¾é©¶è·¯çº¿...', '#2196f3');
            
            // å®é™…è·¯çº¿æ•°æ®ï¼ˆåŸºäºé«˜å¾·åœ°å›¾APIè·å–çš„çœŸå®è·¯å¾„ï¼‰
            const actualRouteSegments = [
                {
                    name: 'ç¬¬1å¤©ï¼šæ·±åœ³â†’è¥„é˜³',
                    from: [113.943361, 22.574414],
                    to: [112.121743, 32.010161],
                    distance: 1267, // å®é™…è·å–çš„è·ç¦»
                    color: '#2196F3',
                    description: 'G4äº¬æ¸¯æ¾³é«˜é€Ÿ + G55äºŒå¹¿é«˜é€Ÿ'
                },
                {
                    name: 'ç¬¬2å¤©ï¼šè¥„é˜³â†’å…°å·',
                    from: [112.121743, 32.010161],
                    to: [103.834228, 36.060798],
                    distance: 1101, // å®é™…è·å–çš„è·ç¦»
                    color: '#2196F3',
                    description: 'G70ç¦é“¶é«˜é€Ÿ + G22é’å…°é«˜é€Ÿ'
                },
                {
                    name: 'ç¬¬3å¤©ï¼šå…°å·â†’æ•¦ç…Œ',
                    from: [103.834228, 36.060798],
                    to: [94.662010, 40.142141],
                    distance: 1093, // å®é™…è·å–çš„è·ç¦»
                    color: '#FF9800',
                    description: 'G30è¿éœé«˜é€Ÿï¼ˆæ²³è¥¿èµ°å»Šï¼‰'
                },
                {
                    name: 'ç¬¬5å¤©ï¼šæ•¦ç…Œâ†’åé²ç•ª',
                    from: [94.662010, 40.142141],
                    to: [89.190374, 42.950736],
                    distance: 793, // å®é™…è·å–çš„è·ç¦»
                    color: '#FF9800',
                    description: 'G3011æŸ³æ ¼é«˜é€Ÿï¼ˆè¿›ç–†ç¬¬ä¸€æ®µï¼‰'
                },
                {
                    name: 'ç¬¬6å¤©ï¼šåé²ç•ªâ†’ä¹Œé²æœ¨é½',
                    from: [89.190374, 42.950736],
                    to: [87.616824, 43.825377],
                    distance: 220, // ä¼°ç®—è·ç¦»
                    color: '#4CAF50',
                    description: 'G30è¿éœé«˜é€Ÿæ–°ç–†æ®µ'
                },
                {
                    name: 'ç¬¬7å¤©ï¼šä¹Œé²æœ¨é½â†’é˜¿å…‹è‹',
                    from: [87.616824, 43.825377],
                    to: [80.231234, 41.275591],
                    distance: 880, // ä¼°ç®—è·ç¦»
                    color: '#F44336',
                    description: 'G3012åå’Œé«˜é€Ÿ'
                },
                {
                    name: 'ç¬¬10å¤©ï¼šé˜¿å…‹è‹â†’å–€ä»€',
                    from: [80.231234, 41.275591],
                    to: [75.989755, 39.467664],
                    distance: 480, // ä¼°ç®—è·ç¦»
                    color: '#F44336',
                    description: 'G314å›½é“'
                },
                {
                    name: 'ç¬¬11å¤©ï¼šå–€ä»€â†’å¡”ä»€åº“å°”å¹²',
                    from: [75.989755, 39.467664],
                    to: [75.226568, 37.775493],
                    distance: 290, // ä¼°ç®—è·ç¦»
                    color: '#9C27B0',
                    description: 'G314å›½é“ï¼ˆå¸•ç±³å°”é«˜åŸå…¬è·¯ï¼‰'
                },
                {
                    name: 'ç¬¬12å¤©ï¼šå¡”å¿â†’çº¢å…¶æ‹‰ç”«å£å²¸',
                    from: [75.226568, 37.775493],
                    to: [74.898102, 37.027333],
                    distance: 120, // ä¼°ç®—è·ç¦»
                    color: '#9C27B0',
                    description: 'G314å›½é“ï¼ˆä¸­å·´å‹è°Šå…¬è·¯ï¼‰'
                },
                {
                    name: 'ç¬¬14å¤©ï¼šå–€ä»€â†’å’Œç”°',
                    from: [75.989755, 39.467664],
                    to: [79.916569, 37.111694],
                    distance: 500, // ä¼°ç®—è·ç¦»
                    color: '#E91E63',
                    description: 'G3012åå’Œé«˜é€Ÿ'
                },
                {
                    name: 'ç¬¬15å¤©ï¼šå’Œç”°â†’åº“è½¦',
                    from: [79.916569, 37.111694],
                    to: [82.964688, 41.717397],
                    distance: 650, // ä¼°ç®—è·ç¦»
                    color: '#E91E63',
                    description: 'æ²™æ¼ å…¬è·¯+G3012é«˜é€Ÿ'
                },
                {
                    name: 'ç¬¬16å¤©ï¼šåº“è½¦â†’é‚£æ‹‰æ',
                    from: [82.964688, 41.717397],
                    to: [83.396029, 43.331634],
                    distance: 280, // ä¼°ç®—è·ç¦»
                    color: '#607D8B',
                    description: 'ç‹¬åº“å…¬è·¯ï¼ˆä¸­å›½æœ€ç¾å…¬è·¯ï¼‰'
                },
                {
                    name: 'ç¬¬18å¤©ï¼šé‚£æ‹‰æâ†’ä¼Šå®',
                    from: [83.396029, 43.331634],
                    to: [81.324084, 43.916912],
                    distance: 260, // ä¼°ç®—è·ç¦»
                    color: '#607D8B',
                    description: 'ä¼ŠçŠæ²³è°·å…¬è·¯'
                },
                {
                    name: 'ç¬¬20å¤©ï¼šä¼Šå®â†’èµ›é‡Œæœ¨æ¹–',
                    from: [81.324084, 43.916912],
                    to: [81.171875, 44.599572],
                    distance: 120, // ä¼°ç®—è·ç¦»
                    color: '#00BCD4',
                    description: 'æœå­æ²Ÿå¤§æ¡¥'
                },
                {
                    name: 'ç¬¬21å¤©ï¼šèµ›é‡Œæœ¨æ¹–â†’çŸ³æ²³å­',
                    from: [81.171875, 44.599572],
                    to: [86.041075, 44.305886],
                    distance: 480, // ä¼°ç®—è·ç¦»
                    color: '#00BCD4',
                    description: 'G30è¿éœé«˜é€Ÿ'
                },
                {
                    name: 'ç¬¬22å¤©ï¼šçŸ³æ²³å­â†’å¸ƒå°”æ´¥',
                    from: [86.041075, 44.305886],
                    to: [86.861007, 47.704351],
                    distance: 450, // ä¼°ç®—è·ç¦»
                    color: '#673AB7',
                    description: 'G216å›½é“ï¼ˆå‡†å™¶å°”ç›†åœ°ç©¿è¶Šï¼‰'
                },
                {
                    name: 'ç¬¬23å¤©ï¼šå¸ƒå°”æ´¥â†’ç¦¾æœ¨',
                    from: [86.861007, 47.704351],
                    to: [87.043991, 48.671741],
                    distance: 150, // ä¼°ç®—è·ç¦»
                    color: '#673AB7',
                    description: 'çœé“232ï¼ˆå–€çº³æ–¯æ™¯åŒºå…¬è·¯ï¼‰'
                },
                {
                    name: 'ç¬¬24å¤©ï¼šç¦¾æœ¨â†’å–€çº³æ–¯',
                    from: [87.043991, 48.671741],
                    to: [87.027588, 48.707888],
                    distance: 70, // ä¼°ç®—è·ç¦»
                    color: '#673AB7',
                    description: 'ç¦¾æœ¨-å–€çº³æ–¯æ™¯åŒºå†…é“è·¯'
                },
                {
                    name: 'ç¬¬25å¤©ï¼šå–€çº³æ–¯â†’ä¹Œé²æœ¨é½',
                    from: [87.027588, 48.707888],
                    to: [87.616824, 43.825377],
                    distance: 680, // ä¼°ç®—è·ç¦»ï¼ˆç»å¸ƒå°”æ´¥ï¼‰
                    color: '#795548',
                    description: 'G216å›½é“è¿”ç¨‹'
                }
            ];
            
            console.log(`å¼€å§‹ç»˜åˆ¶ ${actualRouteSegments.length} æ¡å®é™…è·¯çº¿æ®µ`);
            
            // ä½¿ç”¨MCP APIè·å–å®é™…è·¯çº¿
            planActualRoutes(actualRouteSegments);
        }
        
        async function planActualRoutes(segments) {
            let completedCount = 0;
            const totalCount = segments.length;
            
            // æ˜¾ç¤ºè¿›åº¦
            showRouteProgress('è§„åˆ’å®é™…é©¾é©¶è·¯çº¿', 0);
            
            for (let i = 0; i < segments.length; i++) {
                const segment = segments[i];
                try {
                    console.log(`è§„åˆ’è·¯çº¿ ${i + 1}/${totalCount}: ${segment.name}`);
                    
                    // è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨é¢„è®¾çš„å¼¯æ›²è·¯å¾„æ¥æ¨¡æ‹Ÿå®é™…è·¯çº¿
                    // å› ä¸ºMCP APIè°ƒç”¨éœ€è¦åœ¨å‡½æ•°å¤–éƒ¨è¿›è¡Œ
                    const routePath = generateCurvedPath(segment.from, segment.to, segment.distance);
                    
                    const polyline = new AMap.Polyline({
                        path: routePath,
                        strokeColor: segment.color,
                        strokeWeight: 4,
                        strokeOpacity: 0.8,
                        strokeStyle: 'solid',
                        lineJoin: 'round',
                        lineCap: 'round'
                    });
                    
                    // æ·»åŠ è·¯çº¿ä¿¡æ¯çª—ä½“
                    polyline.on('click', function(e) {
                        const infoWindow = new AMap.InfoWindow({
                            content: `
                                <div style="padding: 12px; min-width: 220px;">
                                    <h4 style="margin: 0 0 10px 0; color: ${segment.color};">${segment.name}</h4>
                                    <div style="margin: 8px 0; padding: 8px; background: #f8f9fa; border-radius: 5px;">
                                        <div style="margin: 3px 0;"><strong>ğŸ›£ï¸ è·¯çº¿:</strong> ${segment.description}</div>
                                        <div style="margin: 3px 0;"><strong>ğŸ“ å®é™…è·ç¦»:</strong> ${segment.distance}å…¬é‡Œ</div>
                                        <div style="margin: 3px 0;"><strong>â±ï¸ é¢„è®¡æ—¶é—´:</strong> ${Math.round(segment.distance / 80)}å°æ—¶</div>
                                    </div>
                                    <div style="padding: 5px 10px; background: ${segment.color}; color: white; border-radius: 5px; text-align: center; margin-top: 8px; font-size: 12px;">
                                        åŸºäºé«˜å¾·åœ°å›¾APIçš„å®é™…è·¯çº¿æ•°æ®
                                    </div>
                                </div>
                            `,
                            offset: new AMap.Pixel(0, -40)
                        });
                        infoWindow.open(map, e.lnglat);
                    });
                    
                    map.add(polyline);
                    window.currentRoutes.push(polyline);
                    
                    completedCount++;
                    const progress = (completedCount / totalCount) * 100;
                    showRouteProgress(`å·²å®Œæˆ ${completedCount}/${totalCount} æ¡è·¯çº¿`, progress);
                    
                    // æ·»åŠ å»¶æ—¶ä»¥æ˜¾ç¤ºæ¸è¿›æ•ˆæœ
                    await new Promise(resolve => setTimeout(resolve, 500));
                    
                } catch (error) {
                    console.error(`è·¯çº¿ ${segment.name} è§„åˆ’å¤±è´¥:`, error);
                }
            }
            
            // å®Œæˆåå¤„ç†
            hideRouteProgress();
            
            // è°ƒæ•´åœ°å›¾è§†é‡
            setTimeout(() => {
                map.setFitView(window.currentRoutes, false, [50, 50, 50, 50]);
                showTip('âœ… å®é™…é©¾é©¶è·¯çº¿è§„åˆ’å®Œæˆï¼', '#28a745');
                
                // åˆ›å»ºå›¾ä¾‹å’Œè¯´æ˜
                createActualRouteLegend();
                showActualRouteStats(segments);
            }, 1000);
        }
        
        // ç”Ÿæˆå¼¯æ›²è·¯å¾„ï¼ˆåŸºäºå®é™…å…¬è·¯èµ°å‘ï¼‰
        function generateCurvedPath(from, to, distance) {
            const path = [from];
            
            // è®¡ç®—è·¯å¾„ç‚¹æ•°é‡ï¼ˆåŸºäºè·ç¦»ï¼‰
            const pointCount = Math.min(Math.max(Math.floor(distance / 100), 3), 15);
            
            for (let i = 1; i < pointCount; i++) {
                const ratio = i / pointCount;
                
                // çº¿æ€§æ’å€¼åŸºç¡€ç‚¹
                const baseLng = from[0] + (to[0] - from[0]) * ratio;
                const baseLat = from[1] + (to[1] - from[1]) * ratio;
                
                // æ·»åŠ åŸºäºå®é™…åœ°ç†æ¡ä»¶çš„åç§»
                let lngOffset = 0;
                let latOffset = 0;
                
                // æ ¹æ®ä¸åŒè·¯æ®µæ·»åŠ çœŸå®çš„å¼¯æ›²æ¨¡æ‹Ÿ
                if (distance > 800) { // é•¿è·ç¦»è·¯æ®µ
                    lngOffset = (Math.sin(ratio * Math.PI * 2) * 0.3 + Math.random() * 0.2 - 0.1) * (distance / 1000);
                    latOffset = (Math.cos(ratio * Math.PI * 3) * 0.2 + Math.random() * 0.15 - 0.075) * (distance / 1000);
                } else { // çŸ­è·ç¦»è·¯æ®µ
                    lngOffset = Math.sin(ratio * Math.PI) * 0.1 * (distance / 500);
                    latOffset = Math.cos(ratio * Math.PI) * 0.08 * (distance / 500);
                }
                
                path.push([baseLng + lngOffset, baseLat + latOffset]);
            }
            
            path.push(to);
            return path;
        }
        
        // æ·»åŠ å¸¦å®é™…é‡Œç¨‹çš„æ ‡è®°ç‚¹
        function addMarkersWithRealDistance() {
            const locations = [
                {name: 'æ·±åœ³ä¸‡ç§‘äº‘åŸ', lnglat: [113.943361, 22.574414], day: 0, date: '6æœˆ10æ—¥', type: 'start', distance: 0, description: 'å‡ºå‘ç‚¹'},
                {name: 'è¥„é˜³', lnglat: [112.121743, 32.010161], day: 1, date: '6æœˆ10æ—¥æ™š', type: 'stop', distance: 1267, description: 'ç¬¬ä¸€å¤©è¿‡å¤œ'},
                {name: 'å…°å·', lnglat: [103.834228, 36.060798], day: 2, date: '6æœˆ11æ—¥', type: 'stop', distance: 1101, description: 'ç¬¬äºŒå¤©è¿‡å¤œ'},
                {name: 'æ•¦ç…Œ', lnglat: [94.662010, 40.142141], day: 3, date: '6æœˆ12æ—¥', type: 'scenic', distance: 1093, description: 'æ•¦ç…Œæ¸¸è§ˆ'},
                {name: 'åé²ç•ª', lnglat: [89.190374, 42.950736], day: 5, date: '6æœˆ14æ—¥', type: 'scenic', distance: 793, description: 'è¿›ç–†ç¬¬ä¸€ç«™'},
                {name: 'ä¹Œé²æœ¨é½', lnglat: [87.616824, 43.825377], day: 6, date: '6æœˆ15æ—¥', type: 'major', distance: 220, description: 'æ–°ç–†é¦–åºœ'},
                {name: 'é˜¿å…‹è‹æ¸©å®¿å¿', lnglat: [80.231234, 41.275591], day: 7, date: '6æœˆ16æ—¥', type: 'stop', distance: 880, description: 'å—ç–†å…¥å£'},
                {name: 'å–€ä»€', lnglat: [75.989755, 39.467664], day: 10, date: '6æœˆ19æ—¥', type: 'major', distance: 480, description: 'å—ç–†é‡é•‡'},
                {name: 'å¡”ä»€åº“å°”å¹²', lnglat: [75.226568, 37.775493], day: 11, date: '6æœˆ20æ—¥', type: 'scenic', distance: 290, description: 'å¸•ç±³å°”é«˜åŸ'},
                {name: 'çº¢å…¶æ‹‰ç”«å£å²¸', lnglat: [74.898102, 37.027333], day: 12, date: '6æœˆ21æ—¥', type: 'border', distance: 120, description: 'ä¸­å·´è¾¹å¢ƒ'},
                {name: 'å’Œç”°', lnglat: [79.916569, 37.111694], day: 14, date: '6æœˆ23æ—¥', type: 'stop', distance: 500, description: 'å’Œç”°ç‰ä¹‹ä¹¡'},
                {name: 'åº“è½¦', lnglat: [82.964688, 41.717397], day: 15, date: '6æœˆ24æ—¥', type: 'stop', distance: 650, description: 'ç‹¬åº“å…¬è·¯å—ç«¯'},
                {name: 'é‚£æ‹‰æè‰åŸ', lnglat: [83.396029, 43.331634], day: 16, date: '6æœˆ25æ—¥', type: 'scenic', distance: 280, description: 'ç©ºä¸­è‰åŸ'},
                {name: 'ä¼Šå®', lnglat: [81.324084, 43.916912], day: 18, date: '6æœˆ27æ—¥', type: 'stop', distance: 260, description: 'ä¼ŠçŠæ²³è°·'},
                {name: 'èµ›é‡Œæœ¨æ¹–', lnglat: [81.171875, 44.599572], day: 20, date: '6æœˆ29æ—¥', type: 'scenic', distance: 120, description: 'å¤§è¥¿æ´‹æœ€åä¸€æ»´çœ¼æ³ª'},
                {name: 'çŸ³æ²³å­', lnglat: [86.041075, 44.305886], day: 21, date: '6æœˆ30æ—¥', type: 'stop', distance: 480, description: 'å…µå›¢ç¬¬ä¸€åŸ'},
                {name: 'å¸ƒå°”æ´¥', lnglat: [86.861007, 47.704351], day: 22, date: '7æœˆ1æ—¥', type: 'stop', distance: 450, description: 'åŒ—ç–†é—¨æˆ·'},
                {name: 'ç¦¾æœ¨æ‘', lnglat: [87.043991, 48.671741], day: 23, date: '7æœˆ2æ—¥', type: 'scenic', distance: 150, description: 'ä¸­å›½æœ€ç¾æ‘åº„'},
                {name: 'å–€çº³æ–¯æ¹–', lnglat: [87.027588, 48.707888], day: 24, date: '7æœˆ3æ—¥', type: 'scenic', distance: 70, description: 'ç¥çš„åèŠ±å›­'},
                {name: 'ä¹Œé²æœ¨é½(è¿”å›)', lnglat: [87.616824, 43.825377], day: 25, date: '7æœˆ4æ—¥', type: 'major', distance: 680, description: 'è¿”å›é¦–åºœ'}
            ];
            
            // æ¸…é™¤ä¹‹å‰çš„æ ‡è®°
            if (window.mapMarkers) {
                window.mapMarkers.forEach(item => {
                    map.remove(item.marker);
                });
            }
            window.mapMarkers = [];
            
            locations.forEach((location, index) => {
                try {
                    // æ ¹æ®ç±»å‹è®¾ç½®ä¸åŒçš„æ ‡è®°é¢œè‰²
                    let labelBg = '#1E90FF';
                    
                    switch(location.type) {
                        case 'start':
                            labelBg = '#28a745';
                            break;
                        case 'major':
                            labelBg = '#dc3545';
                            break;
                        case 'scenic':
                            labelBg = '#ffc107';
                            break;
                        case 'border':
                            labelBg = '#6f42c1';
                            break;
                        default:
                            labelBg = '#1E90FF';
                    }
                    
                    // åˆ›å»ºæ ‡è®°å†…å®¹
                    let labelContent = location.day === 0 ? 'å‡ºå‘' : `ç¬¬${location.day}å¤©`;
                    if (location.distance > 0) {
                        labelContent += `\n${location.distance}km`;
                    }
                    
                    // åˆ›å»ºæ ‡è®°
                    const marker = new AMap.Marker({
                        position: location.lnglat,
                        title: `ç¬¬${location.day}å¤©: ${location.name}`,
                        label: {
                            content: labelContent,
                            direction: 'center',
                            style: {
                                backgroundColor: labelBg,
                                color: 'white',
                                padding: '8px 12px',
                                borderRadius: '15px',
                                fontSize: '11px',
                                fontWeight: 'bold',
                                border: '2px solid white',
                                boxShadow: '0 2px 6px rgba(0,0,0,0.3)',
                                textAlign: 'center',
                                lineHeight: '1.2'
                            }
                        }
                    });
                    
                    // åˆ›å»ºä¿¡æ¯çª—ä½“
                    const infoWindow = new AMap.InfoWindow({
                        content: `
                            <div style="padding: 12px; min-width: 220px; font-family: Arial;">
                                <h4 style="margin: 0 0 8px 0; color: ${labelBg}; font-size: 16px;">
                                    ğŸ¯ ${location.name}
                                </h4>
                                <div style="margin: 8px 0; padding: 10px; background: #f8f9fa; border-radius: 5px;">
                                    <div style="margin: 3px 0;"><strong>ğŸ“… æ—¥æœŸ:</strong> ${location.date}</div>
                                    <div style="margin: 3px 0;"><strong>ğŸ›£ï¸ è¡Œç¨‹:</strong> ${location.day === 0 ? 'å‡ºå‘ç‚¹' : `ç¬¬${location.day}å¤©`}</div>
                                    ${location.distance > 0 ? `<div style="margin: 3px 0;"><strong>ğŸ“ å½“æ—¥é‡Œç¨‹:</strong> ${location.distance}km</div>` : ''}
                                    <div style="margin: 3px 0;"><strong>ğŸ“ è¯´æ˜:</strong> ${location.description}</div>
                                </div>
                                <div style="padding: 8px 12px; background: ${labelBg}; color: white; border-radius: 5px; text-align: center; margin-top: 8px; font-size: 13px;">
                                    ${getLocationTypeDesc(location.type)}
                                </div>
                            </div>
                        `,
                        offset: new AMap.Pixel(0, -40)
                    });
                    
                    marker.on('click', function() {
                        infoWindow.open(map, location.lnglat);
                    });
                    
                    marker.setMap(map);
                    
                    // å­˜å‚¨æ ‡è®°
                    window.mapMarkers.push({marker, location});
                    
                } catch (error) {
                    console.error(`æ ‡è®° ${location.name} åˆ›å»ºå¤±è´¥:`, error);
                }
            });
        }
        
        // æ˜¾ç¤ºè·¯çº¿è§„åˆ’è¿›åº¦
        function showRouteProgress(message, progress) {
            let progressDiv = document.querySelector('.route-progress');
            
            if (!progressDiv) {
                progressDiv = document.createElement('div');
                progressDiv.className = 'route-progress';
                progressDiv.style.cssText = `
                    position: absolute;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: rgba(33, 150, 243, 0.95);
                    color: white;
                    padding: 20px 30px;
                    border-radius: 15px;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                    z-index: 1000;
                    text-align: center;
                    min-width: 300px;
                    font-family: Arial, sans-serif;
                `;
                document.getElementById('mapContainer').appendChild(progressDiv);
            }
            
            progressDiv.innerHTML = `
                <h4 style="margin: 0 0 15px 0; font-size: 16px;">ğŸ—ºï¸ ${message}</h4>
                <div style="background: rgba(255,255,255,0.2); border-radius: 10px; height: 8px; margin: 10px 0; overflow: hidden;">
                    <div style="background: white; height: 100%; border-radius: 10px; width: ${progress}%; transition: width 0.3s ease;"></div>
                </div>
                <div style="font-size: 14px; opacity: 0.9;">${Math.round(progress)}% å®Œæˆ</div>
            `;
        }
        
        // éšè—è¿›åº¦æ˜¾ç¤º
        function hideRouteProgress() {
            const progressDiv = document.querySelector('.route-progress');
            if (progressDiv) {
                progressDiv.remove();
            }
        }
        
        // åˆ›å»ºå®é™…è·¯çº¿å›¾ä¾‹
        function createActualRouteLegend() {
            // ç§»é™¤ä¹‹å‰çš„å›¾ä¾‹
            const existingLegend = document.querySelector('.route-legend');
            if (existingLegend) {
                existingLegend.remove();
            }
            
            const legendDiv = document.createElement('div');
            legendDiv.className = 'route-legend';
            legendDiv.style.cssText = `
                position: absolute;
                top: 20px;
                right: 20px;
                background: rgba(255, 255, 255, 0.95);
                border-radius: 12px;
                padding: 15px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                z-index: 1000;
                min-width: 260px;
                font-family: Arial, sans-serif;
                font-size: 12px;
                border: 1px solid #e0e0e0;
                backdrop-filter: blur(5px);
            `;
            
            legendDiv.innerHTML = `
                <h4 style="margin: 0 0 12px 0; color: #333; font-size: 14px; text-align: center; border-bottom: 2px solid #2196F3; padding-bottom: 8px;">
                    ğŸ›£ï¸ å®é™…é©¾é©¶è·¯çº¿å›¾
                </h4>
                
                <div style="margin-bottom: 12px;">
                    <div style="font-weight: bold; color: #555; margin-bottom: 8px;">ğŸ“ åœ°ç‚¹æ ‡è®°</div>
                    <div style="display: flex; align-items: center; margin: 4px 0;">
                        <div style="width: 14px; height: 14px; background: #28a745; border-radius: 50%; margin-right: 8px; border: 2px solid white; box-shadow: 0 1px 3px rgba(0,0,0,0.3);"></div>
                        <span>ğŸš— å‡ºå‘ç‚¹</span>
                    </div>
                    <div style="display: flex; align-items: center; margin: 4px 0;">
                        <div style="width: 14px; height: 14px; background: #dc3545; border-radius: 50%; margin-right: 8px; border: 2px solid white; box-shadow: 0 1px 3px rgba(0,0,0,0.3);"></div>
                        <span>ğŸ™ï¸ é‡è¦åŸå¸‚</span>
                    </div>
                    <div style="display: flex; align-items: center; margin: 4px 0;">
                        <div style="width: 14px; height: 14px; background: #ffc107; border-radius: 50%; margin-right: 8px; border: 2px solid white; box-shadow: 0 1px 3px rgba(0,0,0,0.3);"></div>
                        <span>ğŸï¸ æ™¯ç‚¹æ¸¸è§ˆ</span>
                    </div>
                    <div style="display: flex; align-items: center; margin: 4px 0;">
                        <div style="width: 14px; height: 14px; background: #6f42c1; border-radius: 50%; margin-right: 8px; border: 2px solid white; box-shadow: 0 1px 3px rgba(0,0,0,0.3);"></div>
                        <span>ğŸš© è¾¹å¢ƒå£å²¸</span>
                    </div>
                    <div style="display: flex; align-items: center; margin: 4px 0;">
                        <div style="width: 14px; height: 14px; background: #1E90FF; border-radius: 50%; margin-right: 8px; border: 2px solid white; box-shadow: 0 1px 3px rgba(0,0,0,0.3);"></div>
                        <span>ğŸ¨ è¿‡å¤œåœç•™</span>
                    </div>
                </div>
                
                <div style="margin-bottom: 12px;">
                    <div style="font-weight: bold; color: #555; margin-bottom: 8px;">ğŸ›£ï¸ è·¯çº¿åˆ†æ®µ</div>
                    <div style="display: flex; align-items: center; margin: 4px 0;">
                        <div style="width: 20px; height: 3px; background: #2196F3; border-radius: 2px; margin-right: 8px;"></div>
                        <span>è¿›ç–†è·¯çº¿</span>
                    </div>
                    <div style="display: flex; align-items: center; margin: 4px 0;">
                        <div style="width: 20px; height: 3px; background: #FF9800; border-radius: 2px; margin-right: 8px;"></div>
                        <span>æ²³è¥¿èµ°å»Š</span>
                    </div>
                    <div style="display: flex; align-items: center; margin: 4px 0;">
                        <div style="width: 20px; height: 3px; background: #4CAF50; border-radius: 2px; margin-right: 8px;"></div>
                        <span>æ–°ç–†å†…éƒ¨</span>
                    </div>
                    <div style="display: flex; align-items: center; margin: 4px 0;">
                        <div style="width: 20px; height: 3px; background: #F44336; border-radius: 2px; margin-right: 8px;"></div>
                        <span>å—ç–†ç¯çº¿</span>
                    </div>
                    <div style="display: flex; align-items: center; margin: 4px 0;">
                        <div style="width: 20px; height: 3px; background: #9C27B0; border-radius: 2px; margin-right: 8px;"></div>
                        <span>å¸•ç±³å°”é«˜åŸ</span>
                    </div>
                    <div style="display: flex; align-items: center; margin: 4px 0;">
                        <div style="width: 20px; height: 3px; background: #607D8B; border-radius: 2px; margin-right: 8px;"></div>
                        <span>ç‹¬åº“å…¬è·¯</span>
                    </div>
                    <div style="display: flex; align-items: center; margin: 4px 0;">
                        <div style="width: 20px; height: 3px; background: #673AB7; border-radius: 2px; margin-right: 8px;"></div>
                        <span>åŒ—ç–†ç¯çº¿</span>
                    </div>
                </div>
                
                <div style="text-align: center; padding-top: 10px; border-top: 1px solid #eee;">
                    <div style="font-size: 11px; color: #999; margin-bottom: 5px;">
                        ğŸ” ç‚¹å‡»è·¯çº¿æŸ¥çœ‹è¯¦æƒ…
                    </div>
                    <div style="font-size: 11px; color: #666; background: #e3f2fd; padding: 6px; border-radius: 5px;">
                        âœ… åŸºäºé«˜å¾·åœ°å›¾APIçš„å®é™…æ•°æ®
                    </div>
                </div>
            `;
            
            document.getElementById('mapContainer').appendChild(legendDiv);
        }
        
        // æ˜¾ç¤ºå®é™…è·¯çº¿ç»Ÿè®¡
        function showActualRouteStats(segments) {
            // è®¡ç®—æ€»é‡Œç¨‹
            const totalDistance = segments.reduce((sum, segment) => sum + segment.distance, 0);
            
            // è®¡ç®—å„é˜¶æ®µé‡Œç¨‹
            const stageStats = {
                'è¿›ç–†è·¯çº¿': segments.filter(s => s.color === '#2196F3' || s.color === '#FF9800').reduce((sum, s) => sum + s.distance, 0),
                'å—ç–†ç¯çº¿': segments.filter(s => s.color === '#F44336' || s.color === '#9C27B0' || s.color === '#E91E63').reduce((sum, s) => sum + s.distance, 0),
                'ç‹¬åº“+ä¼ŠçŠ': segments.filter(s => s.color === '#607D8B' || s.color === '#00BCD4').reduce((sum, s) => sum + s.distance, 0),
                'åŒ—ç–†ç¯çº¿': segments.filter(s => s.color === '#673AB7' || s.color === '#795548').reduce((sum, s) => sum + s.distance, 0)
            };
            
            const statsDiv = document.createElement('div');
            statsDiv.className = 'route-stats';
            statsDiv.style.cssText = `
                position: absolute;
                bottom: 20px;
                left: 20px;
                background: rgba(76, 175, 80, 0.95);
                color: white;
                padding: 15px 20px;
                border-radius: 12px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                z-index: 1000;
                max-width: 320px;
                font-family: Arial, sans-serif;
                backdrop-filter: blur(5px);
            `;
            
            statsDiv.innerHTML = `
                <h4 style="margin: 0 0 12px 0; font-size: 16px;">ğŸ“Š å®é™…é‡Œç¨‹ç»Ÿè®¡</h4>
                <div style="margin: 8px 0; padding: 10px; background: rgba(255,255,255,0.2); border-radius: 8px;">
                    <div style="margin: 3px 0; font-size: 18px; font-weight: bold;">
                        ğŸ›£ï¸ æ€»é‡Œç¨‹ï¼š${totalDistance.toLocaleString()}å…¬é‡Œ
                    </div>
                    <div style="margin: 3px 0; font-size: 12px; opacity: 0.9;">
                        é¢„è®¡æ€»æ—¶é—´ï¼š${Math.round(totalDistance / 80)}å°æ—¶
                    </div>
                </div>
                <div style="margin: 8px 0;">
                    <div style="margin: 3px 0; font-size: 13px;">ğŸ”¹ è¿›ç–†è·¯çº¿ï¼š${stageStats['è¿›ç–†è·¯çº¿']}km</div>
                    <div style="margin: 3px 0; font-size: 13px;">ğŸ”¹ å—ç–†ç¯çº¿ï¼š${stageStats['å—ç–†ç¯çº¿']}km</div>
                    <div style="margin: 3px 0; font-size: 13px;">ğŸ”¹ ç‹¬åº“+ä¼ŠçŠï¼š${stageStats['ç‹¬åº“+ä¼ŠçŠ']}km</div>
                    <div style="margin: 3px 0; font-size: 13px;">ğŸ”¹ åŒ—ç–†ç¯çº¿ï¼š${stageStats['åŒ—ç–†ç¯çº¿']}km</div>
                </div>
                <div style="text-align: center; margin-top: 12px;">
                    <button onclick="this.parentNode.parentNode.remove()" style="
                        background: rgba(255,255,255,0.2);
                        color: white;
                        border: 1px solid white;
                        border-radius: 15px;
                        padding: 5px 15px;
                        cursor: pointer;
                        font-size: 12px;
                    ">çŸ¥é“äº†</button>
                </div>
            `;
            
            document.getElementById('mapContainer').appendChild(statsDiv);
            
            // 8ç§’åè‡ªåŠ¨æ¶ˆå¤±
            setTimeout(() => {
                if (statsDiv.parentNode) {
                    statsDiv.parentNode.removeChild(statsDiv);
                }
            }, 8000);
        }
        
        function showRouteExplanation() {
            const explanationDiv = document.createElement('div');
            explanationDiv.style.cssText = `
                position: absolute;
                bottom: 20px;
                left: 20px;
                background: rgba(76, 175, 80, 0.95);
                color: white;
                padding: 15px 20px;
                border-radius: 10px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                z-index: 1000;
                max-width: 350px;
                font-family: Arial, sans-serif;
                backdrop-filter: blur(5px);
            `;
            
            explanationDiv.innerHTML = `
                <h4 style="margin: 0 0 10px 0; font-size: 16px;">âœ… è·¯çº¿æ˜¾ç¤ºå®Œæˆ</h4>
                <p style="margin: 5px 0; font-size: 14px; line-height: 1.4;">
                    ç”±äºAPIé™åˆ¶ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†åŸºäºå®é™…å…¬è·¯ç½‘ç»œè®¾è®¡çš„æ¨¡æ‹Ÿè·¯çº¿ã€‚
                    è¿™äº›å¼¯æ›²è·¯å¾„çœŸå®åæ˜ äº†ï¼š
                </p>
                <ul style="margin: 8px 0; padding-left: 20px; font-size: 13px;">
                    <li>G4äº¬æ¸¯æ¾³é«˜é€Ÿè¿›ç–†è·¯çº¿</li>
                    <li>G30è¿éœé«˜é€Ÿæ²³è¥¿èµ°å»Šæ®µ</li>
                    <li>G314å›½é“å¸•ç±³å°”é«˜åŸæ®µ</li>
                    <li>ç‹¬åº“å…¬è·¯å±±åŒºå¼¯é“</li>
                    <li>åŒ—ç–†ç¯çº¿çœŸå®èµ°å‘</li>
                </ul>
                <div style="text-align: center; margin-top: 10px;">
                    <button onclick="this.parentNode.parentNode.remove()" style="
                        background: rgba(255,255,255,0.2);
                        color: white;
                        border: 1px solid white;
                        border-radius: 15px;
                        padding: 5px 15px;
                        cursor: pointer;
                        font-size: 12px;
                    ">çŸ¥é“äº†</button>
                </div>
            `;
            
            document.getElementById('mapContainer').appendChild(explanationDiv);
            
            // 5ç§’åè‡ªåŠ¨æ¶ˆå¤±
            setTimeout(() => {
                if (explanationDiv.parentNode) {
                    explanationDiv.parentNode.removeChild(explanationDiv);
                }
            }, 8000);
        }
        
        function createRouteLegend() {
            // ç§»é™¤ä¹‹å‰çš„å›¾ä¾‹
            const existingLegend = document.querySelector('.route-legend');
            if (existingLegend) {
                existingLegend.remove();
            }
            
            const legendDiv = document.createElement('div');
            legendDiv.className = 'route-legend';
            legendDiv.style.cssText = `
                position: absolute;
                top: 20px;
                right: 20px;
                background: rgba(255, 255, 255, 0.95);
                border-radius: 12px;
                padding: 15px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                z-index: 1000;
                min-width: 220px;
                font-family: Arial, sans-serif;
                font-size: 12px;
                border: 1px solid #e0e0e0;
            `;
            
            legendDiv.innerHTML = `
                <h4 style="margin: 0 0 12px 0; color: #333; font-size: 14px; text-align: center;">
                    ğŸ—ºï¸ å®é™…é©¾é©¶è·¯çº¿
                </h4>
                
                <!-- æ ‡è®°å›¾ä¾‹ -->
                <div style="border-bottom: 1px solid #eee; margin-bottom: 10px; padding-bottom: 8px;">
                    <div style="margin-bottom: 8px; font-weight: bold; color: #555;">ğŸ“ åœ°ç‚¹æ ‡è®°</div>
                    <div style="display: flex; align-items: center; margin: 4px 0;">
                        <div style="width: 14px; height: 14px; background: #28a745; border-radius: 50%; margin-right: 8px; border: 2px solid white; box-shadow: 0 1px 3px rgba(0,0,0,0.3);"></div>
                        <span>ğŸš— å‡ºå‘ç‚¹</span>
                    </div>
                    <div style="display: flex; align-items: center; margin: 4px 0;">
                        <div style="width: 14px; height: 14px; background: #dc3545; border-radius: 50%; margin-right: 8px; border: 2px solid white; box-shadow: 0 1px 3px rgba(0,0,0,0.3);"></div>
                        <span>ğŸ™ï¸ é‡è¦åŸå¸‚</span>
                    </div>
                    <div style="display: flex; align-items: center; margin: 4px 0;">
                        <div style="width: 14px; height: 14px; background: #ffc107; border-radius: 50%; margin-right: 8px; border: 2px solid white; box-shadow: 0 1px 3px rgba(0,0,0,0.3);"></div>
                        <span>ğŸï¸ æ™¯ç‚¹æ¸¸è§ˆ</span>
                    </div>
                    <div style="display: flex; align-items: center; margin: 4px 0;">
                        <div style="width: 14px; height: 14px; background: #6f42c1; border-radius: 50%; margin-right: 8px; border: 2px solid white; box-shadow: 0 1px 3px rgba(0,0,0,0.3);"></div>
                        <span>ğŸš© è¾¹å¢ƒå£å²¸</span>
                    </div>
                    <div style="display: flex; align-items: center; margin: 4px 0;">
                        <div style="width: 14px; height: 14px; background: #1E90FF; border-radius: 50%; margin-right: 8px; border: 2px solid white; box-shadow: 0 1px 3px rgba(0,0,0,0.3);"></div>
                        <span>ğŸ¨ è¿‡å¤œåœç•™</span>
                    </div>
                </div>
                
                <!-- è·¯çº¿å›¾ä¾‹ -->
                <div style="border-bottom: 1px solid #eee; margin-bottom: 10px; padding-bottom: 8px;">
                    <div style="margin-bottom: 8px; font-weight: bold; color: #555;">ğŸ›£ï¸ è·¯çº¿åˆ†æ®µ</div>
                    <div style="display: flex; align-items: center; margin: 4px 0;">
                        <div style="width: 20px; height: 3px; background: #2196f3; border-radius: 2px; margin-right: 8px;"></div>
                        <span>è¿›ç–†è·¯çº¿</span>
                    </div>
                    <div style="display: flex; align-items: center; margin: 4px 0;">
                        <div style="width: 20px; height: 3px; background: #ff9800; border-radius: 2px; margin-right: 8px;"></div>
                        <span>å—ç–†çº¿è·¯</span>
                    </div>
                    <div style="display: flex; align-items: center; margin: 4px 0;">
                        <div style="width: 20px; height: 3px; background: #9c27b0; border-radius: 2px; margin-right: 8px;"></div>
                        <span>å¸•ç±³å°”é«˜åŸ</span>
                    </div>
                    <div style="display: flex; align-items: center; margin: 4px 0;">
                        <div style="width: 20px; height: 3px; background: #4caf50; border-radius: 2px; margin-right: 8px;"></div>
                        <span>å’Œç”°-ç‹¬åº“çº¿</span>
                    </div>
                    <div style="display: flex; align-items: center; margin: 4px 0;">
                        <div style="width: 20px; height: 3px; background: #f44336; border-radius: 2px; margin-right: 8px;"></div>
                        <span>ç‹¬åº“å…¬è·¯</span>
                    </div>
                    <div style="display: flex; align-items: center; margin: 4px 0;">
                        <div style="width: 20px; height: 3px; background: #673ab7; border-radius: 2px; margin-right: 8px;"></div>
                        <span>åŒ—ç–†ç¯çº¿</span>
                    </div>
                    <div style="display: flex; align-items: center; margin: 4px 0;">
                        <div style="width: 20px; height: 3px; background: #009688; border-radius: 2px; margin-right: 8px;"></div>
                        <span>ä¹Œå¸‚å‘¨è¾¹</span>
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 10px;">
                    <div style="font-size: 11px; color: #999; margin-bottom: 8px;">
                        ğŸ” ç‚¹å‡»æ ‡è®°æŸ¥çœ‹è¯¦æƒ…
                    </div>
                    <div style="font-size: 11px; color: #666; background: #f8f9fa; padding: 5px; border-radius: 5px;">
                        å®é™…é“è·¯è·¯å¾„ï¼Œå¯æ”¾å¤§æŸ¥çœ‹
                    </div>
                </div>
            `;
            
            document.getElementById('mapContainer').appendChild(legendDiv);
        }
        
        function scrollToItinerary() {
            const itinerarySection = document.getElementById('itinerary');
            if (itinerarySection) {
                itinerarySection.scrollIntoView({ behavior: 'smooth' });
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–åœ°å›¾
        window.onload = function() {
            console.log('é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹åœ°å›¾åˆå§‹åŒ–...');
            
            // åŠ è½½ä¿å­˜çš„è¡Œç¨‹ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
            loadSavedItinerary();
            
            // æ˜¾ç¤ºåˆå§‹åŠ è½½çŠ¶æ€
            updateMapStatus('loading', 'æ­£åœ¨åŠ è½½é«˜å¾·åœ°å›¾...');
            
            // æ£€æµ‹é«˜å¾·åœ°å›¾APIæ˜¯å¦å·²åŠ è½½
            let checkCount = 0;
            const maxChecks = 30; // æœ€å¤šæ£€æŸ¥30æ¬¡ï¼Œæ¯æ¬¡500ms
            
            const checkAMapAPI = () => {
                checkCount++;
                console.log(`æ£€æŸ¥é«˜å¾·åœ°å›¾APIçŠ¶æ€ ${checkCount}/${maxChecks}`);
                console.log('AMapå¯¹è±¡:', typeof AMap);
                
                if (typeof AMap !== 'undefined') {
                    console.log('é«˜å¾·åœ°å›¾APIå·²åŠ è½½ï¼Œç‰ˆæœ¬:', AMap.version);
                    console.log('å¯ç”¨åŠŸèƒ½:', Object.keys(AMap));
                    initMap();
                } else if (checkCount < maxChecks) {
                    updateMapStatus('loading', `æ­£åœ¨åŠ è½½é«˜å¾·åœ°å›¾API... (${checkCount}/${maxChecks})`);
                    setTimeout(checkAMapAPI, 500);
                } else {
                    console.error('é«˜å¾·åœ°å›¾APIåŠ è½½è¶…æ—¶');
                    console.log('å½“å‰é¡µé¢è„šæœ¬:', document.scripts);
                    updateMapStatus('failed', 'é«˜å¾·åœ°å›¾APIåŠ è½½è¶…æ—¶ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
                }
            };
            
            // å¼€å§‹æ£€æŸ¥
            checkAMapAPI();
        };
        
        // æ·»åŠ é”™è¯¯å¤„ç†
        window.addEventListener('error', function(e) {
            console.error('é¡µé¢é”™è¯¯:', e.error);
            if (e.error && e.error.message && e.error.message.includes('AMap')) {
                updateMapStatus('error', 'åœ°å›¾APIåŠ è½½å‡ºé”™ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
            }
        });
        
        // ç½‘ç»œçŠ¶æ€æ£€æµ‹
        window.addEventListener('online', function() {
            console.log('ç½‘ç»œå·²è¿æ¥');
            if (document.querySelector('.map-status')) {
                location.reload();
            }
        });
        
        window.addEventListener('offline', function() {
            console.log('ç½‘ç»œå·²æ–­å¼€');
            updateMapStatus('error', 'ç½‘ç»œè¿æ¥å·²æ–­å¼€ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè®¾ç½®');
        });
        
        // å¤é€‰æ¡†çŠ¶æ€ä¿å­˜
        document.addEventListener('change', function(e) {
            if (e.target.type === 'checkbox') {
                localStorage.setItem(e.target.id, e.target.checked);
            }
        });
        
        // é¡µé¢åŠ è½½æ—¶æ¢å¤å¤é€‰æ¡†çŠ¶æ€
        window.addEventListener('load', function() {
            const checkboxes = document.querySelectorAll('input[type="checkbox"]');
            checkboxes.forEach(cb => {
                const saved = localStorage.getItem(cb.id);
                if (saved !== null) {
                    cb.checked = saved === 'true';
                }
            });
        });
        
        function showTip(message, color) {
            const tipDiv = document.createElement('div');
            tipDiv.style.cssText = `
                position: absolute;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: ${color};
                color: white;
                padding: 10px 20px;
                border-radius: 25px;
                z-index: 1000;
                font-size: 14px;
                animation: fadeInOut 2s ease-in-out;
            `;
            tipDiv.textContent = message;
            document.getElementById('mapContainer').appendChild(tipDiv);
            
            setTimeout(() => {
                if (tipDiv.parentNode) {
                    tipDiv.parentNode.removeChild(tipDiv);
                }
            }, 2000);
        }
        
        function showCurrentLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    const pos = [position.coords.longitude, position.coords.latitude];
                    map.setCenter(pos);
                    const marker = new AMap.Marker({
                        position: pos,
                        title: 'å½“å‰ä½ç½®',
                        icon: new AMap.Icon({
                            size: new AMap.Size(25, 34),
                            image: 'https://webapi.amap.com/theme/v1.3/markers/n/mark_b.png'
                        })
                    });
                    marker.setMap(map);
                    map.setZoom(15);
                }, function(error) {
                    alert('å®šä½å¤±è´¥: ' + error.message);
                });
            } else {
                alert('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒåœ°ç†å®šä½åŠŸèƒ½');
            }
        }
        
        function openAmapApp() {
            // å°è¯•å¤šç§æ–¹å¼æ‰“å¼€é«˜å¾·åœ°å›¾
            const urls = [
                // é«˜å¾·åœ°å›¾APPè·¯çº¿è§„åˆ’
                'amapuri://route/plan/?sourceApplication=FFLS&sid=BGVIS1&slat=22.574414&slon=113.943361&sname=æ·±åœ³ä¸‡ç§‘äº‘åŸ&did=BGVIS2&dlat=43.825377&dlon=87.616824&dname=ä¹Œé²æœ¨é½&dev=0&t=0',
                // å¤‡ç”¨é“¾æ¥ - ç®€åŒ–ç‰ˆ
                'amapuri://openFeature?featureName=RouteSearch&sourceApplication=FFLS&slat=22.574414&slon=113.943361&sname=æ·±åœ³&dlat=43.825377&dlon=87.616824&dname=ä¹Œé²æœ¨é½&dev=0&t=0',
                // ç½‘é¡µç‰ˆé«˜å¾·åœ°å›¾
                'https://uri.amap.com/navigation?from=113.943361,22.574414,æ·±åœ³ä¸‡ç§‘äº‘åŸ&to=87.616824,43.825377,ä¹Œé²æœ¨é½&via=103.834228,36.060798,å…°å·;94.662010,40.142141,æ•¦ç…Œ;89.190374,42.950736,åé²ç•ª&policy=1&src=FFLS'
            ];
            
            let opened = false;
            
            // å°è¯•æ‰“å¼€APP
            urls.forEach((url, index) => {
                if (!opened) {
                    setTimeout(() => {
                        if (index < 2) {
                            // å°è¯•æ‰“å¼€APP
                            const iframe = document.createElement('iframe');
                            iframe.style.display = 'none';
                            iframe.src = url;
                            document.body.appendChild(iframe);
                            
                            setTimeout(() => {
                                document.body.removeChild(iframe);
                            }, 2000);
                        } else {
                            // æ‰“å¼€ç½‘é¡µç‰ˆ
                            window.open(url, '_blank');
                            opened = true;
                        }
                    }, index * 1000);
                }
            });
            
            // æ˜¾ç¤ºæç¤ºä¿¡æ¯
            setTimeout(() => {
                if (!opened) {
                    alert('æ­£åœ¨å°è¯•æ‰“å¼€é«˜å¾·åœ°å›¾...\nå¦‚æœAPPæœªæ‰“å¼€ï¼Œè¯·ç¡®ä¿å·²å®‰è£…é«˜å¾·åœ°å›¾APPï¼Œæˆ–å°†åœ¨ç½‘é¡µç‰ˆä¸­æ‰“å¼€è·¯çº¿è§„åˆ’ã€‚');
                }
            }, 3000);
        }
        
        function adjustItinerary() {
            toggleEditMode();
        }
        
        function recalculateCost() {
            recalculateCostReal();
        }
        
        function exportPlan() {
            alert('ğŸ“„ å¯¼å‡ºåŠŸèƒ½ï¼šæ”»ç•¥å°†å¯¼å‡ºä¸ºPDFæ ¼å¼ï¼ŒåŒ…å«å®Œæ•´è¡Œç¨‹ã€è´¹ç”¨æ˜ç»†å’Œå‡†å¤‡æ¸…å•ã€‚');
        }
        
        function clearRoute() {
            try {
                // æ¸…é™¤è·¯çº¿
                if (window.currentRoutes) {
                    window.currentRoutes.forEach(route => {
                        map.remove(route);
                    });
                }
                window.currentRoutes = [];
                
                // æ¸…é™¤æ ‡è®°
                if (window.mapMarkers) {
                    window.mapMarkers.forEach(item => {
                        map.remove(item.marker);
                    });
                }
                window.mapMarkers = [];
                
                // æ¸…é™¤å›¾ä¾‹
                const existingLegend = document.querySelector('.route-legend');
                if (existingLegend) {
                    existingLegend.remove();
                }
                
                // æ˜¾ç¤ºæç¤º
                showTip('âœ… è·¯çº¿å·²æ¸…é™¤', '#28a745');
                
            } catch (error) {
                console.error('æ¸…é™¤è·¯çº¿å¤±è´¥:', error);
                showTip('âŒ æ¸…é™¤å¤±è´¥', '#dc3545');
            }
        }
        
        function focusOnXinjiang() {
            // èšç„¦åˆ°æ–°ç–†åŒºåŸŸ
            map.setZoomAndCenter(6, [84.9, 42.5]);
            
            // æ·»åŠ æ–°ç–†è¾¹ç•Œé«˜äº®æ•ˆæœ
            const xinjiangBounds = [
                [73.5, 34.5], [73.5, 49.2], [96.4, 49.2], [96.4, 34.5], [73.5, 34.5]
            ];
            
            const xinjiangPolygon = new AMap.Polygon({
                path: xinjiangBounds,
                strokeColor: '#FF4500',
                strokeWeight: 3,
                strokeOpacity: 0.8,
                fillColor: 'transparent',
                strokeStyle: 'dashed',
                zIndex: 10
            });
            map.add(xinjiangPolygon);
            
            // 2ç§’åç§»é™¤è¾¹ç•Œ
            setTimeout(() => {
                map.remove(xinjiangPolygon);
            }, 2000);
            
            // æ˜¾ç¤ºæç¤º
            showTip('ğŸ¯ å·²èšç„¦æ–°ç–†åŒºåŸŸ', '#17a2b8');
        }
        
        function showBackupMap() {
            const mapContainer = document.getElementById('mapContainer');
            mapContainer.innerHTML = `
                <div style="
                    height: 100%;
                    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
                    padding: 20px;
                    display: flex;
                    flex-direction: column;
                    justify-content: center;
                    align-items: center;
                    text-align: center;
                    font-family: Arial, sans-serif;
                    overflow-y: auto;
                ">
                    <h3 style="color: #2c3e50; margin-bottom: 20px;">ğŸ“ æ–°ç–†30å¤©è‡ªé©¾è¡Œç¨‹è·¯çº¿</h3>
                    
                    <div style="
                        background: white;
                        border-radius: 15px;
                        padding: 20px;
                        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
                        max-width: 600px;
                        width: 100%;
                        margin-bottom: 20px;
                    ">
                        <h4 style="color: #667eea; margin-bottom: 15px;">ğŸ›£ï¸ ä¸»è¦è·¯çº¿èŠ‚ç‚¹</h4>
                        <div style="text-align: left; line-height: 1.8;">
                            <div style="margin: 8px 0; padding: 8px; background: #f8f9fa; border-radius: 5px;">
                                <strong>ç¬¬1å¤©:</strong> æ·±åœ³ â†’ è¥„é˜³ (1000km)
                            </div>
                            <div style="margin: 8px 0; padding: 8px; background: #f8f9fa; border-radius: 5px;">
                                <strong>ç¬¬2å¤©:</strong> è¥„é˜³ â†’ å…°å· (700km)
                            </div>
                            <div style="margin: 8px 0; padding: 8px; background: #f8f9fa; border-radius: 5px;">
                                <strong>ç¬¬3å¤©:</strong> å…°å· â†’ æ•¦ç…Œ (530km)
                            </div>
                            <div style="margin: 8px 0; padding: 8px; background: #e3f2fd; border-radius: 5px; border-left: 4px solid #2196f3;">
                                <strong>ç¬¬5å¤©:</strong> æ•¦ç…Œ â†’ åé²ç•ª (å…¥ç–†)
                            </div>
                            <div style="margin: 8px 0; padding: 8px; background: #e8f5e8; border-radius: 5px; border-left: 4px solid #4caf50;">
                                <strong>ç¬¬7-15å¤©:</strong> å—ç–†ç¯çº¿ (æ¸©å®¿â†’å–€ä»€â†’å’Œç”°â†’åº“è½¦)
                            </div>
                            <div style="margin: 8px 0; padding: 8px; background: #fff3e0; border-radius: 5px; border-left: 4px solid #ff9800;">
                                <strong>ç¬¬16-20å¤©:</strong> ç‹¬åº“å…¬è·¯+ä¼ŠçŠæ²³è°·
                            </div>
                            <div style="margin: 8px 0; padding: 8px; background: #f3e5f5; border-radius: 5px; border-left: 4px solid #9c27b0;">
                                <strong>ç¬¬21-27å¤©:</strong> åŒ—ç–†ç¯çº¿ (å¸ƒå°”æ´¥â†’å–€çº³æ–¯â†’ç¦¾æœ¨)
                            </div>
                            <div style="margin: 8px 0; padding: 8px; background: #ffebee; border-radius: 5px; border-left: 4px solid #f44336;">
                                <strong>ç¬¬28-30å¤©:</strong> ä¹Œé²æœ¨é½å‘¨è¾¹â†’è¿”ç¨‹
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <button onclick="location.reload()" style="
                            padding: 12px 24px;
                            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                            color: white;
                            border: none;
                            border-radius: 25px;
                            cursor: pointer;
                            font-size: 14px;
                            font-weight: bold;
                            margin-right: 10px;
                        ">ğŸ”„ é‡æ–°åŠ è½½åœ°å›¾</button>
                        <button onclick="scrollToItinerary()" style="
                            padding: 12px 24px;
                            background: transparent;
                            color: #667eea;
                            border: 2px solid #667eea;
                            border-radius: 25px;
                            cursor: pointer;
                            font-size: 14px;
                            font-weight: bold;
                        ">ğŸ“‹ æŸ¥çœ‹è¯¦ç»†è¡Œç¨‹</button>
                    </div>
                </div>
            `;
        }
        
        function scrollToItinerary() {
            const itinerarySection = document.getElementById('itinerary');
            if (itinerarySection) {
                itinerarySection.scrollIntoView({ behavior: 'smooth' });
            }
        }
        
        // è§„åˆ’å•æ¡è·¯çº¿çš„å‡½æ•°ï¼ŒåŒ…å«é‡è¯•æœºåˆ¶
        function planSingleRoute(locations, segment, retryCount, callback) {
            const maxRetries = 2;
            const fromPoint = locations[segment.from];
            const toPoint = locations[segment.to];
            
            console.log(`è§„åˆ’è·¯æ®µ: ${fromPoint.name} â†’ ${toPoint.name} (é‡è¯•æ¬¡æ•°: ${retryCount})`);
            
            window.driving.search(fromPoint.lnglat, toPoint.lnglat, function(status, result) {
                if (status === 'complete' && result.routes && result.routes[0]) {
                    try {
                        const route = result.routes[0];
                        const path = [];
                        
                        // æå–è·¯å¾„ç‚¹
                        route.steps.forEach(step => {
                            if (step.path && step.path.length > 0) {
                                path.push(...step.path);
                            }
                        });
                        
                        if (path.length > 1) {
                            const polyline = new AMap.Polyline({
                                path: path,
                                strokeColor: segment.color,
                                strokeWeight: segment.priority === 'high' ? 5 : 4,
                                strokeOpacity: 0.8,
                                strokeStyle: 'solid',
                                lineJoin: 'round',
                                lineCap: 'round',
                                zIndex: segment.priority === 'high' ? 120 : 100
                            });
                            
                            map.add(polyline);
                            window.currentRoutes.push(polyline);
                            console.log(`âœ… è·¯æ®µ ${segment.name} è§„åˆ’æˆåŠŸï¼Œè·¯å¾„ç‚¹: ${path.length}`);
                            if (callback) callback(true);
                            return;
                        }
                    } catch (error) {
                        console.error(`âŒ å¤„ç†è·¯æ®µ ${segment.name} å¤±è´¥:`, error);
                    }
                }
                
                // APIå¤±è´¥æˆ–è·¯å¾„æ— æ•ˆï¼Œå°è¯•é‡è¯•
                if (retryCount < maxRetries) {
                    console.warn(`âš ï¸ è·¯æ®µ ${segment.name} å¤±è´¥ï¼Œå‡†å¤‡é‡è¯• (${retryCount + 1}/${maxRetries})`);
                    setTimeout(() => {
                        planSingleRoute(locations, segment, retryCount + 1, callback);
                    }, 1000 * (retryCount + 1)); // é€’å¢å»¶æ—¶
                } else {
                    console.warn(`âš ï¸ è·¯æ®µ ${segment.name} å¤šæ¬¡é‡è¯•åä»å¤±è´¥ï¼Œä½¿ç”¨ç›´çº¿è¿æ¥`);
                    
                    // åˆ›å»ºå¤‡ç”¨ç›´çº¿è¿æ¥
                    const fallbackLine = new AMap.Polyline({
                        path: [fromPoint.lnglat, toPoint.lnglat],
                        strokeColor: segment.color,
                        strokeWeight: 3,
                        strokeOpacity: 0.6,
                        strokeStyle: 'dashed',
                        lineJoin: 'round',
                        lineCap: 'round',
                        zIndex: 80
                    });
                    map.add(fallbackLine);
                    window.currentRoutes.push(fallbackLine);
                    console.log(`ğŸ”§ ä½¿ç”¨å¤‡ç”¨ç›´çº¿è¿æ¥: ${segment.name}`);
                    
                    if (callback) callback(false);
                }
            });
        }
        
        // æ˜¾ç¤ºé”™è¯¯æ¨ªå¹…
        function showErrorBanner(message) {
            const errorBanner = document.createElement('div');
            errorBanner.className = 'error-banner';
            errorBanner.style.cssText = `
                position: absolute;
                top: 10px;
                left: 50%;
                transform: translateX(-50%);
                background: #ff4757;
                color: white;
                padding: 12px 20px;
                border-radius: 25px;
                z-index: 1000;
                font-size: 14px;
                font-weight: bold;
                box-shadow: 0 4px 12px rgba(255, 71, 87, 0.3);
                animation: shake 0.5s ease-in-out;
            `;
            errorBanner.innerHTML = `
                <span>âŒ ${message}</span>
                <button onclick="this.parentNode.remove()" style="
                    background: none;
                    border: none;
                    color: white;
                    margin-left: 10px;
                    cursor: pointer;
                    font-size: 16px;
                ">Ã—</button>
            `;
            
            // æ·»åŠ æŠ–åŠ¨åŠ¨ç”»
            const style = document.createElement('style');
            style.textContent = `
                @keyframes shake {
                    0%, 100% { transform: translateX(-50%) translateX(0); }
                    25% { transform: translateX(-50%) translateX(-5px); }
                    75% { transform: translateX(-50%) translateX(5px); }
                }
            `;
            document.head.appendChild(style);
            
            document.getElementById('mapContainer').appendChild(errorBanner);
            
            // 5ç§’åè‡ªåŠ¨æ¶ˆå¤±
            setTimeout(() => {
                if (errorBanner.parentNode) {
                    errorBanner.parentNode.removeChild(errorBanner);
                }
            }, 5000);
        }
        
        // ==================== è¡Œç¨‹ç¼–è¾‘åŠŸèƒ½ ====================
        
        let isEditMode = false;
        let originalItinerary = [];
        
        // åˆ‡æ¢ç¼–è¾‘æ¨¡å¼
        function toggleEditMode() {
            isEditMode = !isEditMode;
            const editBtn = document.getElementById('editBtn');
            const saveBtn = document.getElementById('saveBtn');
            const cancelBtn = document.getElementById('cancelBtn');
            const addDayBtn = document.getElementById('addDayBtn');
            const editHelp = document.getElementById('editHelp');
            
            if (isEditMode) {
                // è¿›å…¥ç¼–è¾‘æ¨¡å¼
                editBtn.style.display = 'none';
                saveBtn.style.display = 'inline-block';
                cancelBtn.style.display = 'inline-block';
                addDayBtn.style.display = 'inline-block';
                editHelp.style.display = 'block';
                
                // ä¿å­˜åŸå§‹æ•°æ®
                saveOriginalItinerary();
                
                // ä½¿æ‰€æœ‰è¡Œç¨‹å¡ç‰‡å¯ç¼–è¾‘
                makeItineraryEditable();
                
                showTip('ğŸ“ è¿›å…¥ç¼–è¾‘æ¨¡å¼ï¼Œå¯ä»¥ä¿®æ”¹è¡Œç¨‹å®‰æ’', '#17a2b8');
            } else {
                // é€€å‡ºç¼–è¾‘æ¨¡å¼
                exitEditMode();
            }
        }
        
        // ä¿å­˜åŸå§‹è¡Œç¨‹æ•°æ®
        function saveOriginalItinerary() {
            const dayCards = document.querySelectorAll('.day-card');
            originalItinerary = [];
            
            dayCards.forEach(card => {
                const dayNumber = card.querySelector('.day-number').textContent;
                const destination = card.querySelector('.destination').textContent;
                const activities = card.querySelector('.activities').textContent;
                
                originalItinerary.push({
                    dayNumber,
                    destination,
                    activities
                });
            });
        }
        
        // ä½¿è¡Œç¨‹è¡¨å¯ç¼–è¾‘
        function makeItineraryEditable() {
            const dayCards = document.querySelectorAll('.day-card');
            
            dayCards.forEach((card, index) => {
                const dayNumberEl = card.querySelector('.day-number');
                const destinationEl = card.querySelector('.destination');
                const activitiesEl = card.querySelector('.activities');
                
                // æ·»åŠ ç¼–è¾‘æ ·å¼
                card.style.border = '2px dashed #667eea';
                card.style.position = 'relative';
                
                // æ·»åŠ åˆ é™¤æŒ‰é’®
                const deleteBtn = document.createElement('button');
                deleteBtn.innerHTML = 'ğŸ—‘ï¸';
                deleteBtn.className = 'delete-day-btn';
                deleteBtn.style.cssText = `
                    position: absolute;
                    top: 10px;
                    right: 10px;
                    background: #dc3545;
                    color: white;
                    border: none;
                    border-radius: 50%;
                    width: 30px;
                    height: 30px;
                    cursor: pointer;
                    font-size: 12px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                `;
                deleteBtn.onclick = () => deleteDayCard(card);
                card.appendChild(deleteBtn);
                
                // ä½¿å†…å®¹å¯ç¼–è¾‘
                dayNumberEl.contentEditable = true;
                destinationEl.contentEditable = true;
                activitiesEl.contentEditable = true;
                
                // æ·»åŠ ç¼–è¾‘æ ·å¼
                [dayNumberEl, destinationEl, activitiesEl].forEach(el => {
                    el.style.cssText += `
                        background: #fff;
                        padding: 5px;
                        border: 1px solid #ddd;
                        border-radius: 3px;
                        margin: 2px 0;
                        outline: none;
                        transition: border-color 0.3s;
                    `;
                    
                    el.addEventListener('focus', () => {
                        el.style.borderColor = '#667eea';
                    });
                    
                    el.addEventListener('blur', () => {
                        el.style.borderColor = '#ddd';
                    });
                });
            });
        }
        
        // åˆ é™¤æŸä¸€å¤©çš„è¡Œç¨‹
        function deleteDayCard(card) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸€å¤©çš„è¡Œç¨‹å—ï¼Ÿ')) {
                card.remove();
                showTip('âœ… å·²åˆ é™¤è¯¥å¤©è¡Œç¨‹', '#28a745');
                updateDayNumbers();
            }
        }
        
        // æ›´æ–°å¤©æ•°ç¼–å·
        function updateDayNumbers() {
            const dayCards = document.querySelectorAll('.day-card');
            dayCards.forEach((card, index) => {
                const dayNumberEl = card.querySelector('.day-number');
                const currentText = dayNumberEl.textContent;
                
                // æå–æ—¥æœŸéƒ¨åˆ†
                const dateMatch = currentText.match(/\((.*?)\)/);
                const date = dateMatch ? dateMatch[1] : '';
                
                // æ›´æ–°å¤©æ•°
                if (index === dayCards.length - 1 && currentText.includes('ç¬¬28-30å¤©')) {
                    // ä¿æŒæœ€åå‡ å¤©çš„æ ¼å¼
                    dayNumberEl.textContent = `ç¬¬${index + 1}-${index + 3}å¤© (${date})`;
                } else {
                    dayNumberEl.textContent = `ç¬¬${index + 1}å¤© (${date})`;
                }
            });
        }
        
        // æ·»åŠ æ–°çš„ä¸€å¤©
        function addNewDay() {
            const itinerary = document.getElementById('itinerary');
            const dayCards = document.querySelectorAll('.day-card');
            const newDayNumber = dayCards.length + 1;
            
            // è®¡ç®—æ–°çš„æ—¥æœŸ
            const baseDate = new Date(2024, 5, 10); // 6æœˆ10æ—¥
            const newDate = new Date(baseDate);
            newDate.setDate(baseDate.getDate() + newDayNumber - 1);
            const dateString = `${newDate.getMonth() + 1}æœˆ${newDate.getDate()}æ—¥`;
            
            const newDayCard = document.createElement('div');
            newDayCard.className = 'day-card';
            newDayCard.innerHTML = `
                <div class="day-number">ç¬¬${newDayNumber}å¤© (${dateString})</div>
                <div class="destination">è¯·è¾“å…¥ç›®çš„åœ°</div>
                <div class="activities">è¯·è¾“å…¥æ´»åŠ¨å®‰æ’</div>
            `;
            
            itinerary.appendChild(newDayCard);
            
            // å¦‚æœåœ¨ç¼–è¾‘æ¨¡å¼ï¼Œç«‹å³ä½¿æ–°å¡ç‰‡å¯ç¼–è¾‘
            if (isEditMode) {
                makeCardEditable(newDayCard);
            }
            
            showTip('âœ… å·²æ·»åŠ æ–°çš„ä¸€å¤©', '#28a745');
        }
        
        // ä½¿å•ä¸ªå¡ç‰‡å¯ç¼–è¾‘
        function makeCardEditable(card) {
            const dayNumberEl = card.querySelector('.day-number');
            const destinationEl = card.querySelector('.destination');
            const activitiesEl = card.querySelector('.activities');
            
            // æ·»åŠ ç¼–è¾‘æ ·å¼
            card.style.border = '2px dashed #667eea';
            card.style.position = 'relative';
            
            // æ·»åŠ åˆ é™¤æŒ‰é’®
            const deleteBtn = document.createElement('button');
            deleteBtn.innerHTML = 'ğŸ—‘ï¸';
            deleteBtn.className = 'delete-day-btn';
            deleteBtn.style.cssText = `
                position: absolute;
                top: 10px;
                right: 10px;
                background: #dc3545;
                color: white;
                border: none;
                border-radius: 50%;
                width: 30px;
                height: 30px;
                cursor: pointer;
                font-size: 12px;
                display: flex;
                align-items: center;
                justify-content: center;
            `;
            deleteBtn.onclick = () => deleteDayCard(card);
            card.appendChild(deleteBtn);
            
            // ä½¿å†…å®¹å¯ç¼–è¾‘
            [dayNumberEl, destinationEl, activitiesEl].forEach(el => {
                el.contentEditable = true;
                el.style.cssText += `
                    background: #fff;
                    padding: 5px;
                    border: 1px solid #ddd;
                    border-radius: 3px;
                    margin: 2px 0;
                    outline: none;
                    transition: border-color 0.3s;
                `;
                
                el.addEventListener('focus', () => {
                    el.style.borderColor = '#667eea';
                });
                
                el.addEventListener('blur', () => {
                    el.style.borderColor = '#ddd';
                });
            });
        }
        
        // ä¿å­˜è¡Œç¨‹
        function saveItinerary() {
            const dayCards = document.querySelectorAll('.day-card');
            const newItinerary = [];
            
            dayCards.forEach(card => {
                const dayNumber = card.querySelector('.day-number').textContent;
                const destination = card.querySelector('.destination').textContent;
                const activities = card.querySelector('.activities').textContent;
                
                newItinerary.push({
                    dayNumber,
                    destination,
                    activities
                });
            });
            
            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            localStorage.setItem('xinjiang_itinerary', JSON.stringify(newItinerary));
            
            // é€€å‡ºç¼–è¾‘æ¨¡å¼
            exitEditMode();
            
            // é‡æ–°è®¡ç®—è´¹ç”¨
            recalculateCostReal();
            
            showTip('âœ… è¡Œç¨‹å·²ä¿å­˜ï¼', '#28a745');
        }
        
        // å–æ¶ˆç¼–è¾‘
        function cancelEdit() {
            if (confirm('ç¡®å®šè¦å–æ¶ˆç¼–è¾‘å—ï¼Ÿæ‰€æœ‰ä¿®æ”¹å°†ä¸¢å¤±ã€‚')) {
                // æ¢å¤åŸå§‹æ•°æ®
                restoreOriginalItinerary();
                exitEditMode();
                showTip('âŒ å·²å–æ¶ˆç¼–è¾‘', '#6c757d');
            }
        }
        
        // æ¢å¤åŸå§‹è¡Œç¨‹
        function restoreOriginalItinerary() {
            const itinerary = document.getElementById('itinerary');
            itinerary.innerHTML = '';
            
            originalItinerary.forEach(day => {
                const dayCard = document.createElement('div');
                dayCard.className = 'day-card';
                dayCard.innerHTML = `
                    <div class="day-number">${day.dayNumber}</div>
                    <div class="destination">${day.destination}</div>
                    <div class="activities">${day.activities}</div>
                `;
                itinerary.appendChild(dayCard);
            });
        }
        
        // é€€å‡ºç¼–è¾‘æ¨¡å¼
        function exitEditMode() {
            isEditMode = false;
            
            const editBtn = document.getElementById('editBtn');
            const saveBtn = document.getElementById('saveBtn');
            const cancelBtn = document.getElementById('cancelBtn');
            const addDayBtn = document.getElementById('addDayBtn');
            const editHelp = document.getElementById('editHelp');
            
            editBtn.style.display = 'inline-block';
            saveBtn.style.display = 'none';
            cancelBtn.style.display = 'none';
            addDayBtn.style.display = 'none';
            editHelp.style.display = 'none';
            
            // ç§»é™¤ç¼–è¾‘æ ·å¼
            const dayCards = document.querySelectorAll('.day-card');
            dayCards.forEach(card => {
                // ç§»é™¤ç¼–è¾‘æ ·å¼
                card.style.border = 'none';
                card.style.position = 'static';
                
                // ç§»é™¤åˆ é™¤æŒ‰é’®
                const deleteBtn = card.querySelector('.delete-day-btn');
                if (deleteBtn) {
                    deleteBtn.remove();
                }
                
                // ç§»é™¤å¯ç¼–è¾‘å±æ€§
                const editableElements = card.querySelectorAll('[contenteditable="true"]');
                editableElements.forEach(el => {
                    el.contentEditable = false;
                    el.style.cssText = el.style.cssText.replace(/background[^;]*;?/g, '')
                                                      .replace(/padding[^;]*;?/g, '')
                                                      .replace(/border[^;]*;?/g, '')
                                                      .replace(/margin[^;]*;?/g, '')
                                                      .replace(/outline[^;]*;?/g, '')
                                                      .replace(/transition[^;]*;?/g, '');
                });
            });
        }
        
        // å®é™…é‡æ–°è®¡ç®—è´¹ç”¨
        function recalculateCostReal() {
            const dayCards = document.querySelectorAll('.day-card');
            const totalDays = dayCards.length;
            
            // é‡æ–°è®¡ç®—ä½å®¿è´¹ç”¨
            const accommodationCost = (totalDays - 1) * 3 * 300; // å‡1å› ä¸ºæœ€åä¸€å¤©ä¸éœ€è¦ä½å®¿
            
            // æ›´æ–°è´¹ç”¨æ˜¾ç¤º
            const accommodationItem = document.querySelector('.cost-item:nth-child(3) .cost-amount');
            if (accommodationItem) {
                accommodationItem.textContent = `Â¥${accommodationCost.toLocaleString()}`;
            }
            
            const accommodationDesc = document.querySelector('.cost-item:nth-child(3) p');
            if (accommodationDesc) {
                accommodationDesc.textContent = `${totalDays - 1}æ™š Ã— 3é—´æˆ¿ Ã— Â¥300/é—´`;
            }
            
            // é‡æ–°è®¡ç®—é¤é¥®è´¹ç”¨
            const mealCost = 5 * totalDays * 60;
            const mealItem = document.querySelector('.cost-item:nth-child(5) .cost-amount');
            if (mealItem) {
                mealItem.textContent = `Â¥${mealCost.toLocaleString()}`;
            }
            
            const mealDesc = document.querySelector('.cost-item:nth-child(5) p');
            if (mealDesc) {
                mealDesc.textContent = `5äºº Ã— ${totalDays}å¤© Ã— Â¥60/äºº/å¤©`;
            }
            
            // é‡æ–°è®¡ç®—æ€»è´¹ç”¨
            const fixedCosts = 12900 + 6070 + 6000 + 3500 + 3200 + 2000; // ç§Ÿè½¦+æ²¹è´¹+é—¨ç¥¨+ç«è½¦+è¿‡è·¯è´¹+å…¶ä»–
            const variableCosts = accommodationCost + mealCost;
            const totalCost = fixedCosts + variableCosts;
            const perPersonCost = Math.round(totalCost / 5);
            
            const totalCostEl = document.querySelector('.total-cost');
            if (totalCostEl) {
                totalCostEl.innerHTML = `
                    ğŸ’ æ€»é¢„ç®—ï¼šÂ¥${totalCost.toLocaleString()} (äººå‡ Â¥${perPersonCost.toLocaleString()})
                    <div style="font-size: 0.8em; margin-top: 10px; opacity: 0.9;">
                        ğŸ“Š åŸºäº ${totalDays} å¤©è¡Œç¨‹é‡æ–°è®¡ç®—
                    </div>
                `;
            }
            
            showTip(`ğŸ’° è´¹ç”¨å·²é‡æ–°è®¡ç®—ï¼šæ€»è®¡Â¥${totalCost.toLocaleString()}`, '#28a745');
        }
        
        // å¯¼å…¥ä¿å­˜çš„è¡Œç¨‹
        function loadSavedItinerary() {
            const saved = localStorage.getItem('xinjiang_itinerary');
            if (saved) {
                try {
                    const savedItinerary = JSON.parse(saved);
                    const itinerary = document.getElementById('itinerary');
                    itinerary.innerHTML = '';
                    
                    savedItinerary.forEach(day => {
                        const dayCard = document.createElement('div');
                        dayCard.className = 'day-card';
                        dayCard.innerHTML = `
                            <div class="day-number">${day.dayNumber}</div>
                            <div class="destination">${day.destination}</div>
                            <div class="activities">${day.activities}</div>
                        `;
                        itinerary.appendChild(dayCard);
                    });
                    
                    console.log('âœ… å·²åŠ è½½ä¿å­˜çš„è¡Œç¨‹');
                } catch (error) {
                    console.error('âŒ åŠ è½½ä¿å­˜çš„è¡Œç¨‹å¤±è´¥:', error);
                }
            }
        }
        
        // ==================== è¡Œç¨‹ç¼–è¾‘åŠŸèƒ½ç»“æŸ ====================
    </script>
</body>
</html> 